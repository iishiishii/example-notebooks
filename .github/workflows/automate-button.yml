on:
  # Trigger the workflow on push or PR to any branch
  push:
    paths:
      - '**/*.ipynb'
  pull_request:
    paths:
      - '**/*.ipynb'
    # don't trigger for draft PRs
    types: [ opened, synchronize, reopened, ready_for_review ]
  # Trigger the workflow on manual dispatch
  workflow_dispatch:

name: Build
jobs:
  build:
    name: Notebook Test
    runs-on: ubuntu-latest
    container:
      image: vnmd/neurodesktop:latest  # replace <your-docker-image> with your Docker image
      options: --user root
      volumes:
        - /neurodesktop-storage:/neurodesktop-storage
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v2
      - name: Install dependencies
        shell: bash
        run: |
            pip install nbmake pytest-xdist
      - name: Run qsmxt_example
        shell: bash
        run: |
            cd /home/jovyan/example-notebooks/structural_imaging && python -m pytest --nbmake qsmxt_example.ipynb
      - name: Run sct_toolbox_example
        shell: bash
        run: |
            cd /home/jovyan/example-notebooks/structural_imaging && python -m pytest --nbmake sct_toolbox_example.ipynb
      - name: Run sct_toolbox_example
        shell: bash
        run: |
            cd /home/jovyan/example-notebooks/functional_imaging && python -m pytest --nbmake nipype_fsl_all_levels_flanker.ipynb