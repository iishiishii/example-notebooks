
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>AFNI Preprocessing &#8212; Neurodesk</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/algolia.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-4Z9774J59Y"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-4Z9774J59Y');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-4Z9774J59Y');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'AFNI_preprocessing_only';</script>
    <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3.3.3/dist/umd/index.js"></script>
    <script src="_static/algolia.js"></script>
    <link rel="canonical" href="https://neurodesk.github.io/example-notebooks/intro.html/AFNI_preprocessing_only.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="#">
  
  
  
  
  
  
    <p class="title logo__title">Neurodesk</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1 current active">
                <a class="reference internal" href="#">
                    AFNI Preprocessing
                </a>
            </li>
        </ul>
        
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/NeuroDesk/example-notebooks/blob/main/books/AFNI_preprocessing_only.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/NeuroDesk/example-notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NeuroDesk/example-notebooks/edit/main/books/AFNI_preprocessing_only.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NeuroDesk/example-notebooks/issues/new?title=Issue%20on%20page%20%2FAFNI_preprocessing_only.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/AFNI_preprocessing_only.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>AFNI Preprocessing</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#output-cpu-information">Output CPU information</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-afni">Load AFNI</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-python-modules">Import Python Modules</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inspecting-the-anatomical-and-functional-images">Inspecting the anatomical and functional images</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#afni-commands-and-preprocessing">AFNI Commands and Preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#afni-commands">1. AFNI commands</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">2. Preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#slice-time-correction">Slice Time Correction</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#registration-and-normalization">Registration and Normalization</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#registration-with-align-epi-anat-py">Registration with <code class="docutils literal notranslate"><span class="pre">align_epi_anat.py</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#normalization-with-auto-tlrc">Normalization with <code class="docutils literal notranslate"><span class="pre">@auto_tlrc</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#alignment-and-motion-correction">Alignment and Motion Correction</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#smoothing">Smoothing</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#masking-and-scaling">Masking and Scaling</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#masking">Masking</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#scaling">Scaling</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results-checking-preprocessing">Results: Checking Preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizations">Visualizations</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="afni-preprocessing">
<h1>AFNI Preprocessing<a class="headerlink" href="#afni-preprocessing" title="Link to this heading">#</a></h1>
<p>Author: Monika Doerig</p>
<p>Citation:</p>
<p><strong>Andy’s Brain Book:</strong></p>
<ul class="simple">
<li><p>This AFNI example is based on the <a class="reference external" href="https://andysbrainbook.readthedocs.io/en/latest/AFNI/AFNI_Short_Course/AFNI_04_Preprocessing.html">AFNI Tutorial: Commands and Preprocessing</a>  from Andy’s Brain Book (Jahn, 2022. <a class="reference external" href="https://zenodo.org/records/5879294">doi:10.5281/zenodo.5879293</a>)</p></li>
</ul>
<p><strong>Data from OpenNeuro:</strong> Flanker Dataset</p>
<ul class="simple">
<li><p>Kelly AMC and Uddin LQ and Biswal BB and Castellanos FX and Milham MP (2018). Flanker task (event-related). <a class="reference external" href="https://openneuro.org/datasets/ds000102/versions/00001/">OpenNeuro Dataset ds000102</a>. [Dataset] doi: null</p></li>
<li><p>Kelly AM, Uddin LQ, Biswal BB, Castellanos FX, Milham MP. Competition between functional brain networks mediates behavioral variability. Neuroimage. 2008 Jan 1;39(1):527-37. doi: <a class="reference external" href="https://doi.org/10.1016/j.neuroimage.2007.08.008">10.1016/j.neuroimage.2007.08.008</a>. Epub 2007 Aug 23. PMID: 17919929.</p></li>
<li><p>Mennes, M., Kelly, C., Zuo, X.N., Di Martino, A., Biswal, B.B., Castellanos, F.X., Milham, M.P. (2010). Inter-individual differences in resting-state functional connectivity predict task-induced BOLD activity. Neuroimage, 50(4):1690-701. doi: <a class="reference external" href="https://doi.org/10.1016/j.neuroimage.2010.01.002">10.1016/j.neuroimage.2010.01.002</a>. Epub 2010 Jan 15. Erratum in: Neuroimage. 2011 Mar 1;55(1):434</p></li>
<li><p>Mennes, M., Zuo, X.N., Kelly, C., Di Martino, A., Zang, Y.F., Biswal, B., Castellanos, F.X., Milham, M.P. (2011). Linking inter-individual differences in neural activation and behavior to intrinsic brain dynamics. Neuroimage, 54(4):2950-9. doi: <a class="reference external" href="https://doi.org/10.1016/j.neuroimage.2010.10.046">10.1016/j.neuroimage.2010.10.046</a></p></li>
</ul>
<section id="output-cpu-information">
<h2>Output CPU information<a class="headerlink" href="#output-cpu-information" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>cat<span class="w"> </span>/proc/cpuinfo<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;vendor&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq
<span class="o">!</span>cat<span class="w"> </span>/proc/cpuinfo<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;model name&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>vendor_id	: AuthenticAMD
model name	: AMD EPYC 7763 64-Core Processor
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-afni">
<h2>Load AFNI<a class="headerlink" href="#load-afni" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">module</span>
<span class="k">await</span> <span class="n">module</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;afni/21.2.00&#39;</span><span class="p">)</span>
<span class="k">await</span> <span class="n">module</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Lmod&#39;,
 &#39;Warning:&#39;,
 &#39;The&#39;,
 &#39;environment&#39;,
 &#39;MODULEPATH&#39;,
 &#39;has&#39;,
 &#39;been&#39;,
 &#39;changed&#39;,
 &#39;in&#39;,
 &#39;unexpected&#39;,
 &#39;ways.&#39;,
 &#39;Lmod&#39;,
 &#39;is&#39;,
 &#39;unable&#39;,
 &#39;to&#39;,
 &#39;use&#39;,
 &#39;given&#39;,
 &#39;MODULEPATH.&#39;,
 &#39;It&#39;,
 &#39;is&#39;,
 &#39;using:&#39;,
 &#39;&quot;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/functional_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/rodent_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_registration:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/structural_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_segmentation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quantitative_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/workflows:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/hippocampus:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_reconstruction:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/data_organisation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/electrophysiology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/phase_processing:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/programming:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/machine_learning:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/diffusion_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/body:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/visualization:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spectroscopy:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quality_control:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/statistics:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/shape_analysis:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spine:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/molecular_biology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/bids_apps:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/cryo_EM::&quot;.&#39;,
 &#39;Please&#39;,
 &#39;use&#39;,
 &#39;&quot;module&#39;,
 &#39;use&#39;,
 &#39;to&#39;,
 &#39;change&#39;,
 &#39;MODULEPATH&#39;,
 &#39;instead.&#39;,
 &#39;afni/21.2.00&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="import-python-modules">
<h2>Import Python Modules<a class="headerlink" href="#import-python-modules" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">nibabel</span> <span class="n">numpy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">nibabel</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ipyniivue</span><span class="w"> </span><span class="kn">import</span> <span class="n">NiiVue</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">VBox</span><span class="p">,</span> <span class="n">Dropdown</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">widgets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-preparation">
<h2>Data preparation<a class="headerlink" href="#data-preparation" title="Link to this heading">#</a></h2>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PATTERN</span> <span class="o">=</span> <span class="s2">&quot;sub-08&quot;</span>
<span class="o">!</span>datalad<span class="w"> </span>install<span class="w"> </span>https://github.com/OpenNeuroDatasets/ds000102.git
<span class="o">!</span><span class="nb">cd</span><span class="w"> </span>ds000102<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>datalad<span class="w"> </span>get<span class="w"> </span><span class="nv">$PATTERN</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>It is highly recommended to configure Git before using DataLad. Set both &#39;user.name&#39; and &#39;user.email&#39; configuration variables.
Clone attempt:   0%|              | 0.00/2.00 [00:00&lt;?, ? Candidate locations/s]

Enumerating: 0.00 Objects [00:00, ? Objects/s]
                                              
Counting:   0%|                               | 0.00/27.0 [00:00&lt;?, ? Objects/s]
                                                                                
Compressing:   0%|                            | 0.00/23.0 [00:00&lt;?, ? Objects/s]
                                                                                
Receiving:   0%|                             | 0.00/2.15k [00:00&lt;?, ? Objects/s]

Receiving:  36%|███████▉              | 774/2.15k [00:00&lt;00:00, 7.47k Objects/s]

                                                                                
Resolving:   0%|                                | 0.00/537 [00:00&lt;?, ? Deltas/s]
                                                                                
[INFO   ] Author identity unknown
| 
| *** Please tell me who you are.
| 
| Run
| 
|   git config --global user.email &quot;you@example.com&quot;
|   git config --global user.name &quot;Your Name&quot;
| 
| to set your account&#39;s default identity.
| Omit --global to set the identity only in this repository.
| 
| fatal: empty ident name (for &lt;runner@pkrvm1036rseh6a.mp4yp22slbcedhc2uk1h0mde3h.phxx.internal.cloudapp.net&gt;) not allowed
[INFO   ] scanning for unlocked files (this may take some time)
[INFO   ] Remote origin not usable by git-annex; setting annex-ignore
[INFO   ] access to 1 dataset sibling s3-PRIVATE not auto-enabled, enable with:
| 		datalad siblings -d &quot;/tmp/tmpay34gpmm/ds000102&quot; enable -s s3-PRIVATE 
<span class=" -Color -Color-Bold">install</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): /tmp/tmpay34gpmm/ds000102 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">dataset</span>)

It is highly recommended to configure Git before using DataLad. Set both &#39;user.name&#39; and &#39;user.email&#39; configuration variables.
Total:   0%|                                   | 0.00/67.8M [00:00&lt;?, ? Bytes/s]

Get sub-08/a .. 8_T1w.nii.gz:   0%|            | 0.00/10.6M [00:00&lt;?, ? Bytes/s]

Get sub-08/a .. 8_T1w.nii.gz:   1%|    | 85.6k/10.6M [00:00&lt;00:14, 739k Bytes/s]

Get sub-08/a .. 8_T1w.nii.gz:   4%|▏   | 416k/10.6M [00:00&lt;00:05, 1.98M Bytes/s]

Get sub-08/a .. 8_T1w.nii.gz:  16%|▍  | 1.69M/10.6M [00:00&lt;00:01, 6.41M Bytes/s]

Get sub-08/a .. 8_T1w.nii.gz:  41%|█▏ | 4.30M/10.6M [00:00&lt;00:00, 13.7M Bytes/s]

Get sub-08/a .. 8_T1w.nii.gz:  69%|██ | 7.33M/10.6M [00:00&lt;00:00, 19.4M Bytes/s]

Get sub-08/a .. 8_T1w.nii.gz:  98%|██▉| 10.4M/10.6M [00:00&lt;00:00, 23.0M Bytes/s]
Total:  16%|████                      | 10.6M/67.8M [00:01&lt;00:06, 9.45M Bytes/s]

Get sub-08/f .. _bold.nii.gz:   0%|            | 0.00/28.6M [00:00&lt;?, ? Bytes/s]

Get sub-08/f .. _bold.nii.gz:  21%|▌  | 5.94M/28.6M [00:00&lt;00:00, 29.7M Bytes/s]

Get sub-08/f .. _bold.nii.gz:  31%|▉  | 8.96M/28.6M [00:00&lt;00:00, 29.9M Bytes/s]

Get sub-08/f .. _bold.nii.gz:  52%|█▌ | 14.9M/28.6M [00:00&lt;00:00, 29.7M Bytes/s]

Get sub-08/f .. _bold.nii.gz:  62%|█▊ | 17.9M/28.6M [00:00&lt;00:00, 29.8M Bytes/s]

Get sub-08/f .. _bold.nii.gz:  73%|██▏| 20.9M/28.6M [00:00&lt;00:00, 29.9M Bytes/s]

Get sub-08/f .. _bold.nii.gz:  84%|██▌| 23.9M/28.6M [00:00&lt;00:00, 29.9M Bytes/s]

Get sub-08/f .. _bold.nii.gz:  94%|██▊| 26.9M/28.6M [00:00&lt;00:00, 30.0M Bytes/s]

                                                                                
Total:  58%|███████████████           | 39.2M/67.8M [00:02&lt;00:01, 16.7M Bytes/s]

Get sub-08/f .. _bold.nii.gz:   0%|            | 0.00/28.6M [00:00&lt;?, ? Bytes/s]

Get sub-08/f .. _bold.nii.gz:  21%|▋  | 6.00M/28.6M [00:00&lt;00:00, 30.0M Bytes/s]

Get sub-08/f .. _bold.nii.gz:  32%|▉  | 9.03M/28.6M [00:00&lt;00:00, 30.1M Bytes/s]

Get sub-08/f .. _bold.nii.gz:  42%|█▎ | 12.0M/28.6M [00:00&lt;00:00, 30.0M Bytes/s]

Get sub-08/f .. _bold.nii.gz:  53%|█▌ | 15.1M/28.6M [00:00&lt;00:00, 30.1M Bytes/s]

Get sub-08/f .. _bold.nii.gz:  63%|█▉ | 18.1M/28.6M [00:00&lt;00:00, 30.0M Bytes/s]

Get sub-08/f .. _bold.nii.gz:  74%|██▏| 21.1M/28.6M [00:00&lt;00:00, 30.0M Bytes/s]

Get sub-08/f .. _bold.nii.gz:  89%|██▋| 25.5M/28.6M [00:00&lt;00:00, 29.8M Bytes/s]

                                                                                
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-08/anat/sub-08_T1w.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-08/func/sub-08_task-flanker_run-1_bold.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-08/func/sub-08_task-flanker_run-2_bold.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-08 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">directory</span>)
action summary:
  get (ok: 4)

</pre></div>
</div>
</div>
</div>
<p>The data is structured in BIDS format:</p>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>tree<span class="w"> </span>-L<span class="w"> </span><span class="m">4</span><span class="w"> </span>ds000102
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Blue">ds000102</span>
├── CHANGES
├── README
├── T1w.json
├── dataset_description.json
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">derivatives</span>
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">mriqc</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">aMRIQC.csv</span> -&gt; ../../.git/annex/objects/Q4/jv/MD5E-s14180--3addf0456b803b7c5ec5147481ecdd62.csv/MD5E-s14180--3addf0456b803b7c5ec5147481ecdd62.csv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_group.pdf</span> -&gt; ../../.git/annex/objects/6m/q9/MD5E-s98927--d11151f65ae061833e7fd4373adfec3f.pdf/MD5E-s98927--d11151f65ae061833e7fd4373adfec3f.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-01.pdf</span> -&gt; ../../.git/annex/objects/K3/7x/MD5E-s2747349--5d40f2a54fb4194ac4a79f0295ff51c0.pdf/MD5E-s2747349--5d40f2a54fb4194ac4a79f0295ff51c0.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-02.pdf</span> -&gt; ../../.git/annex/objects/Kx/Kv/MD5E-s2803965--56f6b768362bd9b7f0ef501b8cb6dde6.pdf/MD5E-s2803965--56f6b768362bd9b7f0ef501b8cb6dde6.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-03.pdf</span> -&gt; ../../.git/annex/objects/kx/g5/MD5E-s2809843--e90d7a4859ed4be986b55e23f93ca89d.pdf/MD5E-s2809843--e90d7a4859ed4be986b55e23f93ca89d.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-04.pdf</span> -&gt; ../../.git/annex/objects/JK/Zm/MD5E-s2846770--4869146771178dbb01ac79b95b35a8a1.pdf/MD5E-s2846770--4869146771178dbb01ac79b95b35a8a1.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-05.pdf</span> -&gt; ../../.git/annex/objects/zm/FG/MD5E-s2824086--fda634d34556c83005a5eb2ca8c498dd.pdf/MD5E-s2824086--fda634d34556c83005a5eb2ca8c498dd.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-06.pdf</span> -&gt; ../../.git/annex/objects/92/q0/MD5E-s2798058--fdddf0aff1eca8f61ed7c8b04ada9735.pdf/MD5E-s2798058--fdddf0aff1eca8f61ed7c8b04ada9735.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-07.pdf</span> -&gt; ../../.git/annex/objects/39/3K/MD5E-s2795270--29ce2e2352596df940e5f3fae45b5a38.pdf/MD5E-s2795270--29ce2e2352596df940e5f3fae45b5a38.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-08.pdf</span> -&gt; ../../.git/annex/objects/Fx/F4/MD5E-s2727492--b55dad8ffe22fc035110ecf4119d2960.pdf/MD5E-s2727492--b55dad8ffe22fc035110ecf4119d2960.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-09.pdf</span> -&gt; ../../.git/annex/objects/4M/pz/MD5E-s2887144--28ea830af2a4d741147d18ea9c7fda84.pdf/MD5E-s2887144--28ea830af2a4d741147d18ea9c7fda84.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-10.pdf</span> -&gt; ../../.git/annex/objects/0z/Vw/MD5E-s2874045--6542a57a9fc58f97f2a03c2384663c62.pdf/MD5E-s2874045--6542a57a9fc58f97f2a03c2384663c62.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-11.pdf</span> -&gt; ../../.git/annex/objects/wm/76/MD5E-s2781221--1071b83e3c1b4532879521c37c3329da.pdf/MD5E-s2781221--1071b83e3c1b4532879521c37c3329da.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-12.pdf</span> -&gt; ../../.git/annex/objects/GF/19/MD5E-s2817233--bfd24ca3274fa5efd654e2afd927f9ef.pdf/MD5E-s2817233--bfd24ca3274fa5efd654e2afd927f9ef.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-13.pdf</span> -&gt; ../../.git/annex/objects/9Q/X2/MD5E-s2796088--ed299ab7e1662cb03aa01299eed2602b.pdf/MD5E-s2796088--ed299ab7e1662cb03aa01299eed2602b.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-14.pdf</span> -&gt; ../../.git/annex/objects/Wg/55/MD5E-s2558074--cadc9bd81856dcd02677de84e7e6ca90.pdf/MD5E-s2558074--cadc9bd81856dcd02677de84e7e6ca90.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-15.pdf</span> -&gt; ../../.git/annex/objects/43/Q3/MD5E-s2847293--0c678a4b309d055ad9ba4ba25b77351b.pdf/MD5E-s2847293--0c678a4b309d055ad9ba4ba25b77351b.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-16.pdf</span> -&gt; ../../.git/annex/objects/xq/qj/MD5E-s2890454--87c62253c1711f30d53c41b3ac38dc66.pdf/MD5E-s2890454--87c62253c1711f30d53c41b3ac38dc66.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-17.pdf</span> -&gt; ../../.git/annex/objects/zK/M1/MD5E-s2825765--0a91015e22836a3076641b963e1ccfc6.pdf/MD5E-s2825765--0a91015e22836a3076641b963e1ccfc6.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-18.pdf</span> -&gt; ../../.git/annex/objects/w2/Vk/MD5E-s2821624--1d9a3f0b21ce1f9a3b490d44d36f1f11.pdf/MD5E-s2821624--1d9a3f0b21ce1f9a3b490d44d36f1f11.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-19.pdf</span> -&gt; ../../.git/annex/objects/J2/Jq/MD5E-s2453814--533411f3353cb3fa0264485e81f3fcf6.pdf/MD5E-s2453814--533411f3353cb3fa0264485e81f3fcf6.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-20.pdf</span> -&gt; ../../.git/annex/objects/MF/9X/MD5E-s2881144--176c560778c55db87e8468b3246d373c.pdf/MD5E-s2881144--176c560778c55db87e8468b3246d373c.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-21.pdf</span> -&gt; ../../.git/annex/objects/XQ/p1/MD5E-s2330589--b7546dfe5fb43a974cd23111b860c493.pdf/MD5E-s2330589--b7546dfe5fb43a974cd23111b860c493.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-22.pdf</span> -&gt; ../../.git/annex/objects/Fx/k8/MD5E-s2505165--55f0661ad209b742c517cc5b5469436a.pdf/MD5E-s2505165--55f0661ad209b742c517cc5b5469436a.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-23.pdf</span> -&gt; ../../.git/annex/objects/qj/8K/MD5E-s2784018--7e8697a7d4601547a899a27af132166d.pdf/MD5E-s2784018--7e8697a7d4601547a899a27af132166d.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-24.pdf</span> -&gt; ../../.git/annex/objects/G8/Kw/MD5E-s2828817--e86be931adef2a7b0297d557d827d629.pdf/MD5E-s2828817--e86be931adef2a7b0297d557d827d629.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-25.pdf</span> -&gt; ../../.git/annex/objects/XG/kg/MD5E-s2447908--3d392b9d27929dc4146d2b47be16e8dc.pdf/MD5E-s2447908--3d392b9d27929dc4146d2b47be16e8dc.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">anatomical_sub-26.pdf</span> -&gt; ../../.git/annex/objects/8P/42/MD5E-s2850007--6d2f87a305b30d5704aaf4be9b8ff1e6.pdf/MD5E-s2850007--6d2f87a305b30d5704aaf4be9b8ff1e6.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">fMRIQC.csv</span> -&gt; ../../.git/annex/objects/2Z/Ff/MD5E-s21038--cbe73db3db1beb0a1977583cff2a724b.csv/MD5E-s21038--cbe73db3db1beb0a1977583cff2a724b.csv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_group.pdf</span> -&gt; ../../.git/annex/objects/Kq/xg/MD5E-s90712--7058c3db328fecb86303bc27a9ef0110.pdf/MD5E-s90712--7058c3db328fecb86303bc27a9ef0110.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-01.pdf</span> -&gt; ../../.git/annex/objects/k2/vQ/MD5E-s1157925--e055f942b72b9aabad7a5e3d7b25b201.pdf/MD5E-s1157925--e055f942b72b9aabad7a5e3d7b25b201.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-02.pdf</span> -&gt; ../../.git/annex/objects/X3/X6/MD5E-s1235840--cb32b7f8f1274af250b4f0fc15dacecb.pdf/MD5E-s1235840--cb32b7f8f1274af250b4f0fc15dacecb.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-03.pdf</span> -&gt; ../../.git/annex/objects/Vp/0x/MD5E-s1228507--73ab1cc4cb27712892fcb10a0853ba7c.pdf/MD5E-s1228507--73ab1cc4cb27712892fcb10a0853ba7c.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-04.pdf</span> -&gt; ../../.git/annex/objects/xk/jz/MD5E-s1252659--8ae6d1b02767c1ddb72dd7e6afefe696.pdf/MD5E-s1252659--8ae6d1b02767c1ddb72dd7e6afefe696.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-05.pdf</span> -&gt; ../../.git/annex/objects/Zm/VJ/MD5E-s1258815--dd043691d548a501dd63d1aaf420e43c.pdf/MD5E-s1258815--dd043691d548a501dd63d1aaf420e43c.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-06.pdf</span> -&gt; ../../.git/annex/objects/M5/gq/MD5E-s1247345--9c06bc69792b812ab8deffb01c6656c2.pdf/MD5E-s1247345--9c06bc69792b812ab8deffb01c6656c2.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-07.pdf</span> -&gt; ../../.git/annex/objects/25/35/MD5E-s1229731--99cc64e99df0025ccb0341cd0dcf688b.pdf/MD5E-s1229731--99cc64e99df0025ccb0341cd0dcf688b.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-08.pdf</span> -&gt; ../../.git/annex/objects/MX/vQ/MD5E-s1222308--e13c56f17109d3f142c9c4db60fea674.pdf/MD5E-s1222308--e13c56f17109d3f142c9c4db60fea674.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-09.pdf</span> -&gt; ../../.git/annex/objects/90/0F/MD5E-s1265097--41a69211a0569413917ce3825eac95d6.pdf/MD5E-s1265097--41a69211a0569413917ce3825eac95d6.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-10.pdf</span> -&gt; ../../.git/annex/objects/FZ/gq/MD5E-s1299358--12ccfc4a5f52b077b99481fe25aa8ef1.pdf/MD5E-s1299358--12ccfc4a5f52b077b99481fe25aa8ef1.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-11.pdf</span> -&gt; ../../.git/annex/objects/MJ/mQ/MD5E-s1166014--3465ef6b18514d3cd361c0bffe2b73fc.pdf/MD5E-s1166014--3465ef6b18514d3cd361c0bffe2b73fc.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-12.pdf</span> -&gt; ../../.git/annex/objects/xp/1f/MD5E-s1177325--6fe4937d5aa567fb5b3c3977362fc9af.pdf/MD5E-s1177325--6fe4937d5aa567fb5b3c3977362fc9af.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-13.pdf</span> -&gt; ../../.git/annex/objects/4g/vW/MD5E-s1178873--96f341322d21e2bdeb709edc5b047df0.pdf/MD5E-s1178873--96f341322d21e2bdeb709edc5b047df0.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-14.pdf</span> -&gt; ../../.git/annex/objects/5p/6X/MD5E-s1206987--729f64cf514c9103556c53ccb5430bc4.pdf/MD5E-s1206987--729f64cf514c9103556c53ccb5430bc4.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-15.pdf</span> -&gt; ../../.git/annex/objects/m1/k9/MD5E-s1223617--9239a1c2d968ed18093b69d28fd9e654.pdf/MD5E-s1223617--9239a1c2d968ed18093b69d28fd9e654.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-16.pdf</span> -&gt; ../../.git/annex/objects/jq/wP/MD5E-s1294856--5eb7ec97924a22c7e68fd95373694e7e.pdf/MD5E-s1294856--5eb7ec97924a22c7e68fd95373694e7e.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-17.pdf</span> -&gt; ../../.git/annex/objects/0m/3Q/MD5E-s1238563--129db424a50b7889278024828c08c736.pdf/MD5E-s1238563--129db424a50b7889278024828c08c736.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-18.pdf</span> -&gt; ../../.git/annex/objects/VF/Fm/MD5E-s1197868--3b23e8d53b11d98d49b1adf62ff559df.pdf/MD5E-s1197868--3b23e8d53b11d98d49b1adf62ff559df.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-19.pdf</span> -&gt; ../../.git/annex/objects/Jj/m8/MD5E-s1164028--aea7dfa78e9be2e83a9b313f2ebdc4bd.pdf/MD5E-s1164028--aea7dfa78e9be2e83a9b313f2ebdc4bd.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-20.pdf</span> -&gt; ../../.git/annex/objects/x1/ZQ/MD5E-s1292308--8869b1b640797a2be2aa03be69b89840.pdf/MD5E-s1292308--8869b1b640797a2be2aa03be69b89840.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-21.pdf</span> -&gt; ../../.git/annex/objects/MG/zW/MD5E-s1216271--3d5c5ca0f8f4ba06b3289e197a40defd.pdf/MD5E-s1216271--3d5c5ca0f8f4ba06b3289e197a40defd.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-22.pdf</span> -&gt; ../../.git/annex/objects/5m/pj/MD5E-s1142289--4f9e57d8bfe3d39881c43b959189d69f.pdf/MD5E-s1142289--4f9e57d8bfe3d39881c43b959189d69f.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-23.pdf</span> -&gt; ../../.git/annex/objects/m7/Z2/MD5E-s1233046--7758914aecbf2b5d01cd0825952609be.pdf/MD5E-s1233046--7758914aecbf2b5d01cd0825952609be.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-24.pdf</span> -&gt; ../../.git/annex/objects/mz/5m/MD5E-s1265224--c188bd88fc1c99308389f528ea4df71e.pdf/MD5E-s1265224--c188bd88fc1c99308389f528ea4df71e.pdf
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-25.pdf</span> -&gt; ../../.git/annex/objects/Mk/G6/MD5E-s1260984--1b16abcbbf55ccc7763f1d704d76628f.pdf/MD5E-s1260984--1b16abcbbf55ccc7763f1d704d76628f.pdf
│       └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">functional_sub-26.pdf</span> -&gt; ../../.git/annex/objects/1m/zq/MD5E-s1285726--6838f727d5c4b5593a7b5e0e6b20483a.pdf/MD5E-s1285726--6838f727d5c4b5593a7b5e0e6b20483a.pdf
├── participants.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-01</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-01_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/Pf/6k/MD5E-s10581116--757e697a01eeea5c97a7d6fbc7153373.nii.gz/MD5E-s10581116--757e697a01eeea5c97a7d6fbc7153373.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-01_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/5m/w9/MD5E-s28061534--8e8c44ff53f9b5d46f2caae5916fa4ef.nii.gz/MD5E-s28061534--8e8c44ff53f9b5d46f2caae5916fa4ef.nii.gz
│       ├── sub-01_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-01_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/2F/58/MD5E-s28143286--f0bcf782c3688e2cf7149b4665949484.nii.gz/MD5E-s28143286--f0bcf782c3688e2cf7149b4665949484.nii.gz
│       └── sub-01_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-02</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-02_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/3m/FF/MD5E-s10737123--cbd4181ee26559e8ec0a441fa2f834a7.nii.gz/MD5E-s10737123--cbd4181ee26559e8ec0a441fa2f834a7.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-02_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/8v/2j/MD5E-s29188378--80050f0deb13562c24f2fc23f8d095bd.nii.gz/MD5E-s29188378--80050f0deb13562c24f2fc23f8d095bd.nii.gz
│       ├── sub-02_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-02_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/fM/Kw/MD5E-s29193540--cc013f2d7d148b448edca8aada349d02.nii.gz/MD5E-s29193540--cc013f2d7d148b448edca8aada349d02.nii.gz
│       └── sub-02_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-03</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-03_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/7W/9z/MD5E-s10707026--8f1858934cc7c7457e3a4a71cc2131fc.nii.gz/MD5E-s10707026--8f1858934cc7c7457e3a4a71cc2131fc.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-03_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/q6/kF/MD5E-s28755729--b19466702eee6b9385bd6e19e362f94c.nii.gz/MD5E-s28755729--b19466702eee6b9385bd6e19e362f94c.nii.gz
│       ├── sub-03_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-03_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/zV/K1/MD5E-s28782544--8d9700a435d08c90f0c1d534efdc8b69.nii.gz/MD5E-s28782544--8d9700a435d08c90f0c1d534efdc8b69.nii.gz
│       └── sub-03_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-04</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-04_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/FW/14/MD5E-s10738444--2a9a2ba4ea7d2324c84bf5a2882f196c.nii.gz/MD5E-s10738444--2a9a2ba4ea7d2324c84bf5a2882f196c.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-04_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/9Z/0Q/MD5E-s29062799--27171406951ea275cb5857ea0dc32345.nii.gz/MD5E-s29062799--27171406951ea275cb5857ea0dc32345.nii.gz
│       ├── sub-04_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-04_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/FW/FZ/MD5E-s29071279--f89b61fe3ebab26df1374f2564bd95c2.nii.gz/MD5E-s29071279--f89b61fe3ebab26df1374f2564bd95c2.nii.gz
│       └── sub-04_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-05</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-05_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/k2/Kj/MD5E-s10753867--c4b5788da5f4c627f0f5862da5f46c35.nii.gz/MD5E-s10753867--c4b5788da5f4c627f0f5862da5f46c35.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-05_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/VZ/z5/MD5E-s29667270--0ce9ac78b6aa9a77fc94c655a6ff5a06.nii.gz/MD5E-s29667270--0ce9ac78b6aa9a77fc94c655a6ff5a06.nii.gz
│       ├── sub-05_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-05_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/z7/MP/MD5E-s29660544--752750dabb21e2cf28e87d1d550a71b9.nii.gz/MD5E-s29660544--752750dabb21e2cf28e87d1d550a71b9.nii.gz
│       └── sub-05_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-06</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-06_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/5w/G0/MD5E-s10620585--1132eab3830fe59b8a10b6582bb49004.nii.gz/MD5E-s10620585--1132eab3830fe59b8a10b6582bb49004.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-06_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/3x/qj/MD5E-s29386982--e671c0c647ce7d0d4596e35b702ee970.nii.gz/MD5E-s29386982--e671c0c647ce7d0d4596e35b702ee970.nii.gz
│       ├── sub-06_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-06_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/9j/6P/MD5E-s29379265--e513a2746d2b5c603f96044cf48c557c.nii.gz/MD5E-s29379265--e513a2746d2b5c603f96044cf48c557c.nii.gz
│       └── sub-06_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-07</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-07_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/08/fF/MD5E-s10718092--38481fbc489dfb1ec4b174b57591a074.nii.gz/MD5E-s10718092--38481fbc489dfb1ec4b174b57591a074.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-07_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/z1/7W/MD5E-s28946009--5baf7a314874b280543fc0f91f2731af.nii.gz/MD5E-s28946009--5baf7a314874b280543fc0f91f2731af.nii.gz
│       ├── sub-07_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-07_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Jf/W7/MD5E-s28960603--682e13963bfc49cc6ae05e9ba5c62619.nii.gz/MD5E-s28960603--682e13963bfc49cc6ae05e9ba5c62619.nii.gz
│       └── sub-07_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-08</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-08_T1w.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/mw/MM/MD5E-s10561256--b94dddd8dc1c146aa8cd97f8d9994146.nii.gz/MD5E-s10561256--b94dddd8dc1c146aa8cd97f8d9994146.nii.gz</span>
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-08_task-flanker_run-1_bold.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/zX/v9/MD5E-s28641609--47314e6d1a14b8545686110b5b67f8b8.nii.gz/MD5E-s28641609--47314e6d1a14b8545686110b5b67f8b8.nii.gz</span>
│       ├── sub-08_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-08_task-flanker_run-2_bold.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/WZ/F0/MD5E-s28636310--4535bf26281e1c5556ad0d3468e7fe4e.nii.gz/MD5E-s28636310--4535bf26281e1c5556ad0d3468e7fe4e.nii.gz</span>
│       └── sub-08_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-09</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-09_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/QJ/ZZ/MD5E-s10775967--e6a18e64bc0a6b17254a9564cf9b8f82.nii.gz/MD5E-s10775967--e6a18e64bc0a6b17254a9564cf9b8f82.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-09_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/k9/1X/MD5E-s29200533--59e86a903e0ab3d1d320c794ba1f0777.nii.gz/MD5E-s29200533--59e86a903e0ab3d1d320c794ba1f0777.nii.gz
│       ├── sub-09_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-09_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/W3/94/MD5E-s29223017--7f3fb9e260d3bd28e29b0b586ce4c344.nii.gz/MD5E-s29223017--7f3fb9e260d3bd28e29b0b586ce4c344.nii.gz
│       └── sub-09_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-10</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-10_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/5F/3f/MD5E-s10750712--bde2309077bffe22cb65e42ebdce5bfa.nii.gz/MD5E-s10750712--bde2309077bffe22cb65e42ebdce5bfa.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-10_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/3p/qp/MD5E-s29732696--339715d5cec387f4d44dfe94f304a429.nii.gz/MD5E-s29732696--339715d5cec387f4d44dfe94f304a429.nii.gz
│       ├── sub-10_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-10_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/11/Zx/MD5E-s29724034--16f2bf452524a315182f188becc1866d.nii.gz/MD5E-s29724034--16f2bf452524a315182f188becc1866d.nii.gz
│       └── sub-10_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-11</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-11_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/kj/xX/MD5E-s10534963--9e5bff7ec0b5df2850e1d05b1af281ba.nii.gz/MD5E-s10534963--9e5bff7ec0b5df2850e1d05b1af281ba.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-11_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/35/fk/MD5E-s28226875--d5012074c2c7a0a394861b010bcf9a8f.nii.gz/MD5E-s28226875--d5012074c2c7a0a394861b010bcf9a8f.nii.gz
│       ├── sub-11_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-11_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/j7/ff/MD5E-s28198976--c0a64e3b549568c44bb40b1588027c9a.nii.gz/MD5E-s28198976--c0a64e3b549568c44bb40b1588027c9a.nii.gz
│       └── sub-11_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-12</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-12_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/kx/2F/MD5E-s10550168--a7f651adc817b6678148b575654532a4.nii.gz/MD5E-s10550168--a7f651adc817b6678148b575654532a4.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-12_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/M0/fX/MD5E-s28403807--f1c3eb2e519020f4315a696ea845fc01.nii.gz/MD5E-s28403807--f1c3eb2e519020f4315a696ea845fc01.nii.gz
│       ├── sub-12_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-12_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/vW/V0/MD5E-s28424992--8740628349be3c056a0411bf4a852b25.nii.gz/MD5E-s28424992--8740628349be3c056a0411bf4a852b25.nii.gz
│       └── sub-12_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-13</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-13_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/wM/Xw/MD5E-s10609761--440413c3251d182086105649164222c6.nii.gz/MD5E-s10609761--440413c3251d182086105649164222c6.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-13_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/mf/M4/MD5E-s28180916--aa35f4ad0cf630d6396a8a2dd1f3dda6.nii.gz/MD5E-s28180916--aa35f4ad0cf630d6396a8a2dd1f3dda6.nii.gz
│       ├── sub-13_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-13_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/XP/76/MD5E-s28202786--8caf1ac548c87b2b35f85e8ae2bf72c1.nii.gz/MD5E-s28202786--8caf1ac548c87b2b35f85e8ae2bf72c1.nii.gz
│       └── sub-13_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-14</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-14_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/Zw/0z/MD5E-s9223596--33abfb5da565f3487e3a7aebc15f940c.nii.gz/MD5E-s9223596--33abfb5da565f3487e3a7aebc15f940c.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-14_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Jp/29/MD5E-s29001492--250f1e4daa9be1d95e06af0d56629cc9.nii.gz/MD5E-s29001492--250f1e4daa9be1d95e06af0d56629cc9.nii.gz
│       ├── sub-14_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-14_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/PK/V2/MD5E-s29068193--5621a3b0af8132c509420b4ad9aaf8fb.nii.gz/MD5E-s29068193--5621a3b0af8132c509420b4ad9aaf8fb.nii.gz
│       └── sub-14_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-15</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-15_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/Mz/qq/MD5E-s10752891--ddd2622f115ec0d29a0c7ab2366f6f95.nii.gz/MD5E-s10752891--ddd2622f115ec0d29a0c7ab2366f6f95.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-15_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/08/JJ/MD5E-s28285239--feda22c4526af1910fcee58d4c42f07e.nii.gz/MD5E-s28285239--feda22c4526af1910fcee58d4c42f07e.nii.gz
│       ├── sub-15_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-15_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/9f/0W/MD5E-s28289760--433000a1def662e72d8433dba151c61b.nii.gz/MD5E-s28289760--433000a1def662e72d8433dba151c61b.nii.gz
│       └── sub-15_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-16</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-16_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/4g/8k/MD5E-s10927450--a196f7075c793328dd6ff3cebf36ea6b.nii.gz/MD5E-s10927450--a196f7075c793328dd6ff3cebf36ea6b.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-16_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/9z/g2/MD5E-s29757991--1a1648b2fa6cc74e31c94f109d8137ba.nii.gz/MD5E-s29757991--1a1648b2fa6cc74e31c94f109d8137ba.nii.gz
│       ├── sub-16_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-16_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/k8/4F/MD5E-s29773832--fe08739ea816254395b985ee704aaa99.nii.gz/MD5E-s29773832--fe08739ea816254395b985ee704aaa99.nii.gz
│       └── sub-16_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-17</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-17_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/jQ/MQ/MD5E-s10826014--8e2a6b062df4d1c4327802f2b905ef36.nii.gz/MD5E-s10826014--8e2a6b062df4d1c4327802f2b905ef36.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-17_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Wz/2P/MD5E-s28991563--9845f461a017a39d1f6e18baaa0c9c41.nii.gz/MD5E-s28991563--9845f461a017a39d1f6e18baaa0c9c41.nii.gz
│       ├── sub-17_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-17_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/jF/3m/MD5E-s29057821--84ccc041163bcc5b3a9443951e2a5a78.nii.gz/MD5E-s29057821--84ccc041163bcc5b3a9443951e2a5a78.nii.gz
│       └── sub-17_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-18</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-18_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/3v/pK/MD5E-s10571510--6fc4b5792bc50ea4d14eb5247676fafe.nii.gz/MD5E-s10571510--6fc4b5792bc50ea4d14eb5247676fafe.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-18_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/94/P2/MD5E-s28185776--5b3879ec6fc4bbe1e48efc64984f88cf.nii.gz/MD5E-s28185776--5b3879ec6fc4bbe1e48efc64984f88cf.nii.gz
│       ├── sub-18_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-18_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/qp/6K/MD5E-s28234699--58019d798a133e5d7806569374dd8160.nii.gz/MD5E-s28234699--58019d798a133e5d7806569374dd8160.nii.gz
│       └── sub-18_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-19</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-19_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/Zw/p8/MD5E-s8861893--d338005753d8af3f3d7bd8dc293e2a97.nii.gz/MD5E-s8861893--d338005753d8af3f3d7bd8dc293e2a97.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-19_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/04/k6/MD5E-s28178448--3874e748258cf19aa69a05a7c37ad137.nii.gz/MD5E-s28178448--3874e748258cf19aa69a05a7c37ad137.nii.gz
│       ├── sub-19_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-19_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/mz/P4/MD5E-s28190932--91e6b3e4318ca28f01de8cb967cf8421.nii.gz/MD5E-s28190932--91e6b3e4318ca28f01de8cb967cf8421.nii.gz
│       └── sub-19_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-20</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-20_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/g1/FF/MD5E-s11025608--5929806a7aa5720fc755687e1450b06c.nii.gz/MD5E-s11025608--5929806a7aa5720fc755687e1450b06c.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-20_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/v5/ZJ/MD5E-s29931631--bf9abb057367ce66961f0b7913e8e707.nii.gz/MD5E-s29931631--bf9abb057367ce66961f0b7913e8e707.nii.gz
│       ├── sub-20_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-20_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/J3/KW/MD5E-s29945590--96cfd5b77cd096f6c6a3530015fea32d.nii.gz/MD5E-s29945590--96cfd5b77cd096f6c6a3530015fea32d.nii.gz
│       └── sub-20_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-21</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-21_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/K6/6K/MD5E-s8662805--77b262ddd929fa08d78591bfbe558ac6.nii.gz/MD5E-s8662805--77b262ddd929fa08d78591bfbe558ac6.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-21_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Wz/p9/MD5E-s28756041--9ae556d4e3042532d25af5dc4ab31840.nii.gz/MD5E-s28756041--9ae556d4e3042532d25af5dc4ab31840.nii.gz
│       ├── sub-21_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-21_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/xF/M3/MD5E-s28758438--81866411fc6b6333ec382a20ff0be718.nii.gz/MD5E-s28758438--81866411fc6b6333ec382a20ff0be718.nii.gz
│       └── sub-21_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-22</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-22_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/JG/ZV/MD5E-s9282392--9e7296a6a5b68df46b77836182b6681a.nii.gz/MD5E-s9282392--9e7296a6a5b68df46b77836182b6681a.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-22_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/qW/Gw/MD5E-s28002098--c6bea10177a38667ceea3261a642b3c6.nii.gz/MD5E-s28002098--c6bea10177a38667ceea3261a642b3c6.nii.gz
│       ├── sub-22_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-22_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/VX/Zj/MD5E-s28027568--b34d0df9ad62485aba25296939429885.nii.gz/MD5E-s28027568--b34d0df9ad62485aba25296939429885.nii.gz
│       └── sub-22_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-23</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-23_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/4Z/4x/MD5E-s10626062--db5a6ba6730b319c6425f2e847ce9b14.nii.gz/MD5E-s10626062--db5a6ba6730b319c6425f2e847ce9b14.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-23_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/VK/8F/MD5E-s28965005--4a9a96d9322563510ca14439e7fd6cea.nii.gz/MD5E-s28965005--4a9a96d9322563510ca14439e7fd6cea.nii.gz
│       ├── sub-23_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-23_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/56/20/MD5E-s29050413--753b0d2c23c4af6592501219c2e2c6bd.nii.gz/MD5E-s29050413--753b0d2c23c4af6592501219c2e2c6bd.nii.gz
│       └── sub-23_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-24</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-24_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/jQ/fV/MD5E-s10739691--458f0046eff18ee8c43456637766a819.nii.gz/MD5E-s10739691--458f0046eff18ee8c43456637766a819.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-24_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/km/fV/MD5E-s29354610--29ebfa60e52d49f7dac6814cb5fdc2bc.nii.gz/MD5E-s29354610--29ebfa60e52d49f7dac6814cb5fdc2bc.nii.gz
│       ├── sub-24_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-24_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Wj/KK/MD5E-s29423307--fedaa1d7c6e34420735bb3bbe5a2fe38.nii.gz/MD5E-s29423307--fedaa1d7c6e34420735bb3bbe5a2fe38.nii.gz
│       └── sub-24_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-25</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-25_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/Gk/FQ/MD5E-s8998578--f560d832f13e757b485c16d570bf6ebc.nii.gz/MD5E-s8998578--f560d832f13e757b485c16d570bf6ebc.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-25_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/XW/1v/MD5E-s29473003--49b04e7e4b450ec5ef93ff02d4158775.nii.gz/MD5E-s29473003--49b04e7e4b450ec5ef93ff02d4158775.nii.gz
│       ├── sub-25_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-25_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Qm/M7/MD5E-s29460132--b0e9039e9f33510631f229c8c2193285.nii.gz/MD5E-s29460132--b0e9039e9f33510631f229c8c2193285.nii.gz
│       └── sub-25_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-26</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-26_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/kf/9F/MD5E-s10850250--5f103b2660f488e4afa193f9307c1291.nii.gz/MD5E-s10850250--5f103b2660f488e4afa193f9307c1291.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-26_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/QV/10/MD5E-s30127491--8e30aa4bbfcc461bac8598bf621283c5.nii.gz/MD5E-s30127491--8e30aa4bbfcc461bac8598bf621283c5.nii.gz
│       ├── sub-26_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-26_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/3G/Q6/MD5E-s30162480--80fd132e7cb1600ab248249e78f6f1aa.nii.gz/MD5E-s30162480--80fd132e7cb1600ab248249e78f6f1aa.nii.gz
│       └── sub-26_task-flanker_run-2_events.tsv
└── task-flanker_bold.json

80 directories, 192 files
</pre></div>
</div>
</div>
</div>
<section id="inspecting-the-anatomical-and-functional-images">
<h3>Inspecting the anatomical and functional images<a class="headerlink" href="#inspecting-the-anatomical-and-functional-images" title="Link to this heading">#</a></h3>
<p>To use the AFNI graphical user interface, you would type:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">afni</span><span class="w"> </span><span class="nx">sub</span><span class="o">-</span><span class="mf">08</span><span class="nx">_T1w</span><span class="p">.</span><span class="nx">nii</span><span class="p">.</span><span class="nx">gz</span>
</pre></div>
</div>
<p>We will use ipyniivue to look at the data:</p>
<p>Many of the quality checks for the functional images are similar to those for the anatomical images. Look out for excessively bright or dark spots in the grey or white matter, as well as any image distortions, such as abnormal stretching or warping. A common area where slight distortion may occur is in the orbitofrontal region, just above the eyeballs.</p>
<p>Additionally, it’s important to check for excessive motion during the scan.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anat_image</span> <span class="o">=</span> <span class="s1">&#39;./ds000102/sub-08/anat/sub-08_T1w.nii.gz&#39;</span>
<span class="n">func1_image</span> <span class="o">=</span> <span class="s1">&#39;./ds000102/sub-08/func/sub-08_task-flanker_run-1_bold.nii.gz&#39;</span>
<span class="n">func2_image</span> <span class="o">=</span> <span class="s1">&#39;./ds000102/sub-08/func/sub-08_task-flanker_run-2_bold.nii.gz&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># anatomical image</span>
<span class="n">nv</span> <span class="o">=</span> <span class="n">NiiVue</span><span class="p">()</span>
<span class="n">nv</span><span class="o">.</span><span class="n">load_volumes</span><span class="p">([{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">anat_image</span><span class="p">}])</span>
<span class="n">nv</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 1, "model_id": "54a8c1cdef9b4d8098d5d44069a3a537"}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://raw.githubusercontent.com/NeuroDesk/example-notebooks/refs/heads/main/books/images/afni_preproc_anat.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><img src="https://raw.githubusercontent.com/NeuroDesk/example-notebooks/refs/heads/main/books/images/afni_preproc_anat.png"/></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># functional run 1</span>
<span class="n">nv</span> <span class="o">=</span> <span class="n">NiiVue</span><span class="p">()</span>
<span class="n">nv</span><span class="o">.</span><span class="n">load_volumes</span><span class="p">([{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">func1_image</span><span class="p">}])</span>
<span class="n">nv</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 1, "model_id": "aa66fde15c804190863dd0da6afef8a4"}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://raw.githubusercontent.com/NeuroDesk/example-notebooks/refs/heads/main/books/images/afni_preproc_func1.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><img src="https://raw.githubusercontent.com/NeuroDesk/example-notebooks/refs/heads/main/books/images/afni_preproc_func1.png"/></div></div>
</div>
</section>
</section>
<section id="afni-commands-and-preprocessing">
<h2>AFNI Commands and Preprocessing<a class="headerlink" href="#afni-commands-and-preprocessing" title="Link to this heading">#</a></h2>
<p>We will be working with the data from subject sub-08. First, we’ll introduce basic AFNI commands. Then, we’ll create a processing script using <code class="docutils literal notranslate"><span class="pre">afni_proc.py</span></code>, which automates the entire preprocessing workflow. AFNI also provides graphical user interfaces (GUIs), such as <code class="docutils literal notranslate"><span class="pre">uber_subject.py</span></code> and <code class="docutils literal notranslate"><span class="pre">uber_ttest.py</span></code> (for group analysis), which help build processing scripts by combining many commands in the correct order. However, since GUIs cannot be used within a Jupyter Notebook environment, we will focus on writing the scripts directly.</p>
<p>After setting up the automated script, we’ll walk through each preprocessing step individually and discuss how to check data quality before and after each step.</p>
<ul class="simple">
<li><p>1: AFNI Commands</p></li>
<li><p>2: Preprocessing with <code class="docutils literal notranslate"><span class="pre">afni_prc.py</span></code></p>
<ul>
<li><p>Registration and Normalization</p></li>
<li><p>Alignment and Motion Correction</p></li>
<li><p>Smoothing</p></li>
<li><p>Masking and Scaling</p></li>
<li><p>Checking Preprocessing</p></li>
</ul>
</li>
</ul>
<section id="afni-commands">
<h3>1. AFNI commands<a class="headerlink" href="#afni-commands" title="Link to this heading">#</a></h3>
<p>AFNI commands typicallly require at least one argument, or input, and they also usually require you to specify what to call the output of the command.</p>
<p>Let’s take skull-stripping, for example - a common preprocessing step that removes the skull from the brain. The AFNI command to do this step is called 3dSkullStrip. Use the <code class="docutils literal notranslate"><span class="pre">-h</span></code> flag to print the help page.</p>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>3dSkullStrip<span class="w"> </span>-h
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Usage: A program to extract the brain from surrounding.
  tissue from MRI T1-weighted images. 
  The simplest command would be:
        3dSkullStrip &lt;-input DSET&gt;

  Also consider the script @SSwarper, which combines the use of
  3dSkullStrip and nonlinear warping to an MNI template to produce
  a skull-stripped dataset in MNI space, plus the nonlinear warp
  that can used to transform other datasets from the same subject
  (e.g., EPI) to MNI space. (This script only applies to human brain
  images.)

  The fully automated process consists of three steps:
  1- Preprocessing of volume to remove gross spatial image 
  non-uniformity artifacts and reposition the brain in
  a reasonable manner for convenience.
    ** Note that in many cases, using 3dUnifize before **
    ** using 3dSkullStrip will give better results.    **
  2- Expand a spherical surface iteratively until it envelopes
  the brain. This is a modified version of the BET algorithm:
     Fast robust automated brain extraction, 
      by Stephen M. Smith, HBM 2002 v 17:3 pp 143-155
    Modifications include the use of:
     . outer brain surface
     . expansion driven by data inside and outside the surface
     . avoidance of eyes and ventricles
     . a set of operations to avoid the clipping of certain brain
       areas and reduce leakage into the skull in heavily shaded
       data
     . two additional processing stages to ensure convergence and
       reduction of clipped areas.
     . use of 3d edge detection, see Deriche and Monga references
       in 3dedge3 -help.
  3- The creation of various masks and surfaces modeling brain
     and portions of the skull

  Common examples of usage:
  -------------------------
  o 3dSkullStrip -input VOL -prefix VOL_PREFIX
     Vanilla mode, should work for most datasets.
  o 3dSkullStrip -input VOL -prefix VOL_PREFIX -push_to_edge
     Adds an agressive push to brain edges. Use this option
     when the chunks of gray matter are not included. This option
     might cause the mask to leak into non-brain areas.
  o 3dSkullStrip -input VOL -surface_coil -prefix VOL_PREFIX -monkey
     Vanilla mode, for use with monkey data.
  o 3dSkullStrip -input VOL -prefix VOL_PREFIX -ld 30
     Use a denser mesh, in the cases where you have lots of 
     csf between gyri. Also helps when some of the brain is clipped
     close to regions of high curvature.

  Tips:
  -----
     I ran the program with the default parameters on 200+ datasets.
     The results were quite good in all but a couple of instances, here
     are some tips on fixing trouble spots:

     Clipping in frontal areas, close to the eye balls:
        + Try -push_to_edge option first.
          Can also try -no_avoid_eyes option.
     Clipping in general:
        + Try -push_to_edge option first.
          Can also use lower -shrink_fac, start with 0.5 then 0.4
     Problems down below:
        + Piece of cerebellum missing, reduce -shrink_fac_bot_lim 
          from default value.
        + Leakage in lower areas, increase -shrink_fac_bot_lim 
          from default value.
     Some lobules are not included:
        + Use a denser mesh. Start with -ld 30. If that still fails,
        try even higher density (like -ld 50) and increase iterations 
        (say to -niter 750). 
        Expect the program to take much longer in that case.
        + Instead of using denser meshes, you could try blurring the data 
        before skull stripping. Something like -blur_fwhm 2 did
        wonders for some of my data with the default options of 3dSkullStrip
        Blurring is a lot faster than increasing mesh density.
        + Use also a smaller -shrink_fac is you have lots of CSF between
        gyri.
     Massive chunks missing:
        + If brain has very large ventricles and lots of CSF between gyri,
        the ventricles will keep attracting the surface inwards. 
        This often happens with older brains. In such 
        cases, use the -visual option to see what is happening.
        For example, the options below did the trick in various
        instances. 
            -blur_fwhm 2 -use_skull  
        or for more stubborn cases increase csf avoidance with this cocktail
            -blur_fwhm 2 -use_skull -avoid_vent -avoid_vent -init_radius 75 
        + Too much neck in the volume might throw off the initialization
          step. You can fix this by clipping tissue below the brain with 
                 @clip_volume -below ZZZ -input INPUT  
          where ZZZ is a Z coordinate somewhere below the brain.

     Large regions outside brain included:
       + Usually because noise level is high. Try @NoisySkullStrip.

  Make sure that brain orientation is correct. This means the image in 
  AFNI&#39;s axial slice viewer should be close to the brain&#39;s axial plane.
  The same goes for the other planes. Otherwise, the program might do a lousy
  job removing the skull.

  Eye Candy Mode: 
  ---------------
  You can run 3dSkullStrip and have it send successive iterations
 to SUMA and AFNI. This is very helpful in following the
 progression of the algorithm and determining the source
 of trouble, if any.
  Example:
     afni -niml -yesplugouts &amp;
     suma -niml &amp;
     3dSkullStrip -input Anat+orig -o_ply anat_brain -visual

  Help section for the intrepid:
  ------------------------------
  3dSkullStrip  &lt; -input VOL &gt;
             [&lt; -o_TYPE PREFIX &gt;] [&lt; -prefix VOL_PREFIX &gt;] 
             [&lt; -spatnorm &gt;] [&lt; -no_spatnorm &gt;] [&lt; -write_spatnorm &gt;]
             [&lt; -niter N_ITER &gt;] [&lt; -ld LD &gt;] 
             [&lt; -shrink_fac SF &gt;] [&lt; -var_shrink_fac &gt;] 
             [&lt; -no_var_shrink_fac &gt;] [&lt; -shrink_fac_bot_lim SFBL &gt;]
             [&lt; -pushout &gt;] [&lt; -no_pushout &gt;] [&lt; -exp_frac FRAC]
             [&lt; -touchup &gt;] [&lt; -no_touchup &gt;]
             [&lt; -fill_hole R &gt;] [&lt; -NN_smooth NN_SM &gt;]
             [&lt; -smooth_final SM &gt;] [&lt; -avoid_vent &gt;] [&lt; -no_avoid_vent &gt;]
             [&lt; -use_skull &gt;] [&lt; -no_use_skull &gt;] 
             [&lt; -avoid_eyes &gt;] [&lt; -no_avoid_eyes &gt;] 
             [&lt; -use_edge &gt;] [&lt; -no_use_edge &gt;] 
             [&lt; -push_to_edge &gt;] [&lt;-no_push_to_edge&gt;]
             [&lt; -perc_int PERC_INT &gt;] 
             [&lt; -max_inter_iter MII &gt;] [-mask_vol | -orig_vol | -norm_vol]
             [&lt; -debug DBG &gt;] [&lt; -node_debug NODE_DBG &gt;]
             [&lt; -demo_pause &gt;]
             [&lt; -monkey &gt;] [&lt; -marmoset &gt;] [&lt;-rat&gt;]

  NOTE: Please report bugs and strange failures
        to saadz@mail.nih.gov

  Mandatory parameters:
     -input VOL: Input AFNI (or AFNI readable) volume.
                 

  Optional Parameters:
     -monkey: the brain of a monkey.
     -marmoset: the brain of a marmoset. 
                this one was tested on one dataset
                and may not work with non default
                options. Check your results!
     -rat: the brain of a rat.
           By default, no_touchup is used with the rat.
     -surface_coil: Data acquired with a surface coil.
     -o_TYPE PREFIX: prefix of output surface.
        where TYPE specifies the format of the surface
        and PREFIX is, well, the prefix.
        TYPE is one of: fs, 1d (or vec), sf, ply.
        More on that below.
     -skulls: Output surface models of the skull.
     -4Tom:   The output surfaces are named based
             on PREFIX following -o_TYPE option below.
     -prefix VOL_PREFIX: prefix of output volume.
        If not specified, the prefix is the same
        as the one used with -o_TYPE.
        The output volume is skull stripped version
        of the input volume. In the earlier version
        of the program, a mask volume was written out.
        You can still get that mask volume instead of the
        skull-stripped volume with the option -mask_vol . 
        NOTE: In the default setting, the output volume does not 
              have values identical to those in the input. 
              In particular, the range might be larger 
              and some low-intensity values are set to 0.
              If you insist on having the same range of values as in
              the input, then either use option -orig_vol, or run:
         3dcalc -nscale -a VOL+VIEW -b VOL_PREFIX+VIEW \
                -expr &#39;a*step(b)&#39; -prefix VOL_SAME_RANGE
              With the command above, you can preserve the range
              of values of the input but some low-intensity voxels would
              still be masked. If you want to preserve them, then use
              -mask_vol in the 3dSkullStrip command that would produce 
              VOL_MASK_PREFIX+VIEW. Then run 3dcalc masking with voxels
              inside the brain surface envelope:
         3dcalc -nscale -a VOL+VIEW -b VOL_MASK_PREFIX+VIEW \
                -expr &#39;a*step(b-3.01)&#39; -prefix VOL_SAME_RANGE_KEEP_LOW
     -norm_vol: Output a masked and somewhat intensity normalized and 
                thresholded version of the input. This is the default,
                and you can use -orig_vol to override it.
     -orig_vol: Output a masked version of the input AND do not modify
                the values inside the brain as -norm_vol would.
     -mask_vol: Output a mask volume instead of a skull-stripped
                volume.
                The mask volume containes:
                 0: Voxel outside surface
                 1: Voxel just outside the surface. This means the voxel
                    center is outside the surface but inside the 
                    bounding box of a triangle in the mesh. 
                 2: Voxel intersects the surface (a triangle), but center
                    lies outside.
                 3: Voxel contains a surface node.
                 4: Voxel intersects the surface (a triangle), center lies
                    inside surface. 
                 5: Voxel just inside the surface. This means the voxel
                    center is inside the surface and inside the 
                    bounding box of a triangle in the mesh. 
                 6: Voxel inside the surface. 
     -spat_norm: (Default) Perform spatial normalization first.
                 This is a necessary step unless the volume has
                 been &#39;spatnormed&#39; already.
     -no_spatnorm: Do not perform spatial normalization.
                   Use this option only when the volume 
                   has been run through the &#39;spatnorm&#39; process
     -spatnorm_dxyz DXYZ: Use DXY for the spatial resolution of the
                          spatially normalized volume. The default 
                          is the lowest of all three dimensions.
                          For human brains, use DXYZ of 1.0, for
                          primate brain, use the default setting.
     -write_spatnorm: Write the &#39;spatnormed&#39; volume to disk.
     -niter N_ITER: Number of iterations. Default is 250
        For denser meshes, you need more iterations
        N_ITER of 750 works for LD of 50.
     -ld LD: Parameter to control the density of the surface.
             Default is 20 if -no_use_edge is used,
             30 with -use_edge. See CreateIcosahedron -help
             for details on this option.
     -shrink_fac SF: Parameter controlling the brain vs non-brain
             intensity threshold (tb). Default is 0.6.
              tb = (Imax - t2) SF + t2 
             where t2 is the 2 percentile value and Imax is the local
             maximum, limited to the median intensity value.
             For more information on tb, t2, etc. read the BET paper
             mentioned above. Note that in 3dSkullStrip, SF can vary across 
             iterations and might be automatically clipped in certain areas.
             SF can vary between 0 and 1.
             0: Intensities &lt; median inensity are considered non-brain
             1: Intensities &lt; t2 are considered non-brain
     -var_shrink_fac: Vary the shrink factor with the number of
             iterations. This reduces the likelihood of a surface
             getting stuck on large pools of CSF before reaching
             the outer surface of the brain. (Default)
     -no_var_shrink_fac: Do not use var_shrink_fac.
     -shrink_fac_bot_lim SFBL: Do not allow the varying SF to go
             below SFBL . Default 0.65, 0.4 when edge detection is used. 
             This option helps reduce potential for leakage below 
             the cerebellum.
             In certain cases where you have severe non-uniformity resulting
             in low signal towards the bottom of the brain, you will need to
             reduce this parameter.
     -pushout: Consider values above each node in addition to values
               below the node when deciding on expansion. (Default)
     -no_pushout: Do not use -pushout.
     -exp_frac FRAC: Speed of expansion (see BET paper). Default is 0.1.
     -touchup: Perform touchup operations at end to include
               areas not covered by surface expansion. 
               Use -touchup -touchup for aggressive makeup.
               (Default is -touchup)
     -no_touchup: Do not use -touchup
     -fill_hole R: Fill small holes that can result from small surface
                   intersections caused by the touchup operation.
                   R is the maximum number of pixels on the side of a hole
                   that can be filled. Big holes are not filled.
                   If you use -touchup, the default R is 10. Otherwise 
                   the default is 0.
                   This is a less than elegant solution to the small
                   intersections which are usually eliminated
                   automatically. 
     -NN_smooth NN_SM: Perform Nearest Neighbor coordinate interpolation
                       every few iterations. Default is 72
     -smooth_final SM: Perform final surface smoothing after all iterations.
                       Default is 20 smoothing iterations.
                       Smoothing is done using Taubin&#39;s method, 
                       see SurfSmooth -help for detail.
     -avoid_vent: avoid ventricles. Default.
                  Use this option twice to make the avoidance more
                  agressive. That is at times needed with old brains.
     -no_avoid_vent: Do not use -avoid_vent.
     -init_radius RAD: Use RAD for the initial sphere radius.
                       For the automatic setting, there is an
                       upper limit of 100mm for humans.
                       For older brains with lots of CSF, you
                       might benefit from forcing the radius 
                       to something like 75mm
     -avoid_eyes: avoid eyes. Default
     -no_avoid_eyes: Do not use -avoid_eyes.
     -use_edge: Use edge detection to reduce leakage into meninges and eyes.
                Default.
     -no_use_edge: Do no use edges.
     -push_to_edge: Perform aggressive push to edge at the end.
                    This option might cause leakage.
     -no_push_to_edge: (Default).
     -use_skull: Use outer skull to limit expansion of surface into
                 the skull due to very strong shading artifacts.
                 This option is buggy at the moment, use it only 
                 if you have leakage into skull.
     -no_use_skull: Do not use -use_skull (Default).
     -send_no_skull: Do not send the skull surface to SUMA if you are
                     using  -talk_suma
     -perc_int PERC_INT: Percentage of segments allowed to intersect
                         surface. Ideally this should be 0 (Default). 
                         However, few surfaces might have small stubborn
                         intersections that produce a few holes.
                         PERC_INT should be a small number, typically
                         between 0 and 0.1. A -1 means do not do
                         any testing for intersection.
     -max_inter_iter N_II: Number of iteration to remove intersection
                           problems. With each iteration, the program
                           automatically increases the amount of smoothing
                           to get rid of intersections. Default is 4
     -blur_fwhm FWHM: Blur dset after spatial normalization.
                      Recommended when you have lots of CSF in brain
                      and when you have protruding gyri (finger like)
                      Recommended value is 2..4. 
     -interactive: Make the program stop at various stages in the 
                   segmentation process for a prompt from the user
                   to continue or skip that stage of processing.
                   This option is best used in conjunction with options
                   -talk_suma and -feed_afni
     -demo_pause: Pause at various step in the process to facilitate
                  interactive demo while 3dSkullStrip is communicating
                  with AFNI and SUMA. See &#39;Eye Candy&#39; mode below and
                  -talk_suma option. 
     -fac FAC: Multiply input dataset by FAC if range of values is too
               small.

     -visual: Equivalent to using -talk_suma -feed_afni -send_kth 5

     -debug DBG: debug levels of 0 (default), 1, 2, 3.
        This is no Rick Reynolds debug, which is oft nicer
        than the results, but it will do.
     -node_debug NODE_DBG: Output lots of parameters for node
                         NODE_DBG for each iteration.
     The next 3 options are for specifying surface coordinates
     to keep the program from having to recompute them.
     The options are only useful for saving time during debugging.
     -brain_contour_xyz_file BRAIN_CONTOUR_XYZ.1D
     -brain_hull_xyz_file BRAIN_HULL_XYZ.1D
     -skull_outer_xyz_file SKULL_OUTER_XYZ.1D
     -help: The help you need



Compile Date:
   Jul  8 2021

       Ziad S. Saad SSCC/NIMH/NIH saadz@mail.nih.gov
</pre></div>
</div>
</div>
</div>
<p>One of AFNI’s major advantages is the quality of its documentation and help resources. Each command’s usage is thoroughly described, and the purpose behind various options is clearly explained. Example commands are provided to illustrate how to handle different situations — for instance, if too much skull remains after skull-stripping, you might be advised to use a flag like <code class="docutils literal notranslate"><span class="pre">-push_to_edge</span></code>.</p>
<p>The simplest way to run <code class="docutils literal notranslate"><span class="pre">3dSkullStrip</span></code> is by using the <code class="docutils literal notranslate"><span class="pre">-input</span></code> option to specify the anatomical dataset for processing. The <code class="docutils literal notranslate"><span class="pre">-prefix</span></code> option is also used to output a NIfTI image for visualization with ipyniivue.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>3dSkullStrip<span class="w"> </span>-input<span class="w"> </span><span class="nv">$anat_image</span><span class="w"> </span>-prefix<span class="w"> </span>anat_ss.nii.gz<span class="w"> </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The intensity in the output dataset is a modified version
of the intensity in the input volume.
To obtain a masked version of the input with identical values inside
the brain, you can either use 3dSkullStrip&#39;s -orig_vol option
or run the following command:
  3dcalc -a ./ds000102/sub-08/anat/sub-08_T1w.nii.gz -b ./anat_ss.nii.gz+orig -expr &#39;a*step(b)&#39; \
         -prefix ./anat_ss.nii.gz_orig_vol
to generate a new masked version of the input.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">volumes</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">anat_image</span><span class="p">},</span> 
        <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;./anat_ss.nii.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;colormap&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">}]</span>

<span class="n">nv</span> <span class="o">=</span> <span class="n">NiiVue</span><span class="p">()</span>
<span class="n">nv</span><span class="o">.</span><span class="n">load_volumes</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span> 
<span class="n">nv</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 1, "model_id": "8c6ad10e9b91436c8426c68e8a89a04f"}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://raw.githubusercontent.com/NeuroDesk/example-notebooks/refs/heads/main/books/images/afni_preproc_anat_ss.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><img src="https://raw.githubusercontent.com/NeuroDesk/example-notebooks/refs/heads/main/books/images/afni_preproc_anat_ss.png"/></div></div>
</div>
</section>
<section id="preprocessing">
<h3>2. Preprocessing<a class="headerlink" href="#preprocessing" title="Link to this heading">#</a></h3>
<p>To automate preprocessing in AFNI, the powerful <code class="docutils literal notranslate"><span class="pre">afni_proc.py</span></code> tool is used. This command generates a fully customizable tcsh script that includes all necessary preprocessing steps, from slice timing correction to scaling.</p>
<p>The basic idea is:</p>
<ul class="simple">
<li><p>Specify which processing blocks to apply.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">afni_proc.py</span></code> writes a script to carry them out in the correct order.</p></li>
<li><p>The generated script can be reviewed and run, or modified if needed.</p></li>
</ul>
<p>The processing blocks include both automatic steps (such as setup and initial time concatenation) and default blocks that you can customize, skip, or reorder. For example:</p>
<ul class="simple">
<li><p><strong>Automatic blocks</strong>:</p></li>
</ul>
<p>-<code class="docutils literal notranslate"><span class="pre">setup</span></code>: Set up subject information, create output directory (subj_id, script, out_dir)</p>
<p>-<code class="docutils literal notranslate"><span class="pre">tcat</span></code>: Remove unwanted initial TRs.</p>
<ul class="simple">
<li><p><strong>Default blocks</strong>:</p></li>
</ul>
<p>-<code class="docutils literal notranslate"><span class="pre">tshift</span></code>: Slice timing correction.</p>
<p>-<code class="docutils literal notranslate"><span class="pre">volreg</span></code>: Volume registration (motion correction).</p>
<p>-<code class="docutils literal notranslate"><span class="pre">blur</span></code>: Spatial smoothing.</p>
<p>-<code class="docutils literal notranslate"><span class="pre">mask</span></code>: Create a brain mask from EPI data.</p>
<p>-<code class="docutils literal notranslate"><span class="pre">scale</span></code>: Normalize voxel-wise signal intensities.</p>
<p>-<code class="docutils literal notranslate"><span class="pre">regress</span></code>: (optional) Regression analysis for task-based designs.</p>
<p>A full list of options and help can be found in the <a class="reference external" href="https://afni.nimh.nih.gov/pub/dist/doc/program_help/afni_proc.py.html">AFNI documentation</a>.</p>
<p>The following command specifies key preprocessing steps for <code class="docutils literal notranslate"><span class="pre">sub-08</span></code>, including motion correction, normalization to MNI space, smoothing, and scaling. Additionally, the alignment option <code class="docutils literal notranslate"><span class="pre">-giant_move</span></code> is included, which allows for larger shifts and rotations during alignments.</p>
<div style="background-color: #e8f5e9; padding: 12px; border-left: 6px solid #66bb6a; margin: 10px 0; font-size: 16px;">
<b>Preprocessing Workflow:</b><br><br>
➡️ <code>setup</code> ➡️ <code>tcat</code> ➡️ <code>tshift</code> ➡️ <code>align</code> ➡️ <code>tlrc</code> ➡️ <code>volreg</code> ➡️ <code>blur</code> ➡️ <code>mask</code> ➡️ <code>scale</code> ➡️ ✅ <b>outputs</b>
</div><div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>afni_proc.py<span class="w">                                                              </span><span class="err">\</span>
    <span class="o">-</span><span class="n">subj_id</span>                     <span class="n">sub_08</span>                                   \
    <span class="o">-</span><span class="n">script</span>                      <span class="n">proc</span><span class="o">.</span><span class="n">sub_08</span>                              \
    <span class="o">-</span><span class="n">scr_overwrite</span>                                                        \
    <span class="o">-</span><span class="n">out_dir</span>                     <span class="o">./</span><span class="n">afni_processing</span><span class="o">/</span><span class="n">sub_08</span><span class="o">.</span><span class="n">results</span>         \
    <span class="o">-</span><span class="n">blocks</span>                      <span class="n">tshift</span> <span class="n">align</span> <span class="n">tlrc</span> <span class="n">volreg</span> <span class="n">blur</span> <span class="n">mask</span> <span class="n">scale</span> \
    <span class="o">-</span><span class="n">copy_anat</span>                   <span class="err">$</span><span class="n">anat_image</span>                              \
    <span class="o">-</span><span class="n">dsets</span>                                                                \
                                 <span class="err">$</span><span class="n">func1_image</span>                             \
                                 <span class="err">$</span><span class="n">func2_image</span>                             \
    <span class="o">-</span><span class="n">tcat_remove_first_trs</span>       <span class="mi">0</span>                                        \
    <span class="o">-</span><span class="n">align_opts_aea</span> <span class="o">-</span><span class="n">giant_move</span>                                           \
    <span class="o">-</span><span class="n">tlrc_base</span>                   <span class="n">MNI_avg152T1</span><span class="o">+</span><span class="n">tlrc</span>                        \
    <span class="o">-</span><span class="n">volreg_align_to</span>             <span class="n">MIN_OUTLIER</span>                              \
    <span class="o">-</span><span class="n">volreg_align_e2a</span>                                                     \
    <span class="o">-</span><span class="n">volreg_tlrc_warp</span>                                                     \
    <span class="o">-</span><span class="n">blur_size</span>                   <span class="mf">4.0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/afni-latest/afnipy/lib_afni1D.py:1302: SyntaxWarning: &#39;str&#39; object is not callable; perhaps you missed a comma?
  print(&#39;** uncensor from vec: nt = %d, but nocen len = %d&#39; \
-- applying input view as +orig
-- will use min outlier volume as motion base
-- tcat: reps is now 146
++ updating polort to 2, from run len 292.0 s
-- volreg: using base dset vr_base_min_outlier+orig
++ volreg: applying volreg/epi2anat/tlrc xforms to isotropic 3 mm tlrc voxels
-- applying anat warps to 1 dataset(s): sub-08_T1w
-- masking: group anat = &#39;MNI_avg152T1+tlrc&#39;, exists = 1
-- have 1 ROI dict entries ...
-- no regress block, skipping gen_ss_review_scripts.py
-- using default: will not apply EPI Automask
   (see &#39;MASKING NOTE&#39; from the -help for details)

--&gt; script is file: proc.sub_08

    to execute via tcsh:
         tcsh -xef proc.sub_08 |&amp; tee output.proc.sub_08

    to execute via bash:
         tcsh -xef proc.sub_08 2&gt;&amp;1 | tee output.proc.sub_08
</pre></div>
</div>
</div>
</div>
<p><strong>Run the Preprocessing Script and Inspect the Output</strong></p>
<p>Now that we have generated our preprocessing script <code class="docutils literal notranslate"><span class="pre">proc.sub_08</span></code>, we can execute it via tcsh and save a full record of the output in a file called <code class="docutils literal notranslate"><span class="pre">output.proc.sub_08</span></code>.</p>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>tcsh<span class="w"> </span>-xef<span class="w"> </span>proc.sub_08<span class="w"> </span><span class="p">|&amp;</span><span class="w"> </span>tee<span class="w"> </span>output.proc.sub_08
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/bin/bash: line 1: tcsh: command not found
</pre></div>
</div>
</div>
</div>
<p>🔔 While running, pay attention to the following warnings:</p>
<p><strong>3dTshift Warning</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>+ WARNING: dataset is already aligned in time!
+ WARNING: ==&gt;&gt; output dataset is just a copy of input dataset
</pre></div>
</div>
<p>✅ No action needed — this simply means no time-shifting was necessary. You could re-analyze this data by omitting both the 3dTcat and 3dTshift preprocessing steps, and it would get the same result.</p>
<p><strong>&#64;auto_tlrc Warning</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">***********</span> <span class="ne">Warning</span> <span class="o">*************</span>
<span class="n">Dataset</span> <span class="n">centers</span> <span class="n">are</span> <span class="mf">92.736319</span> <span class="n">mm</span>
<span class="n">apart</span><span class="o">.</span> <span class="n">If</span> <span class="n">registration</span> <span class="n">fails</span><span class="p">,</span> <span class="ow">or</span> <span class="k">if</span>
<span class="n">parts</span> <span class="n">of</span> <span class="n">the</span> <span class="n">original</span> <span class="n">anatomy</span> <span class="n">gets</span>
<span class="n">cropped</span><span class="p">,</span> <span class="k">try</span> <span class="n">adding</span> <span class="n">option</span> 
   <span class="o">-</span><span class="n">init_xform</span> <span class="n">AUTO_CENTER</span> 
<span class="n">to</span> <span class="n">your</span> <span class="nd">@auto_tlrc</span> <span class="n">command</span><span class="o">.</span>

<span class="o">*********************************</span>
</pre></div>
</div>
<p>⚠️ This warning requires fixing: we need to modify the <code class="docutils literal notranslate"><span class="pre">proc.sub_08</span></code> script to add <code class="docutils literal notranslate"><span class="pre">-init_xform</span> <span class="pre">AUTO_CENTER</span></code> to the <code class="docutils literal notranslate"><span class="pre">&#64;auto_tlrc</span></code> command to improve alignment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Edit proc.sub_08</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./proc.sub_08&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

<span class="c1"># Insert &quot;-init_xform AUTO_CENTER&quot; into the @auto_tlrc command</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;@auto_tlrc&#39;</span><span class="p">):</span>
        <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; -init_xform AUTO_CENTER</span><span class="se">\n</span><span class="s1">&#39;</span>

<span class="c1"># Save it back</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;proc.sub_08&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Delete any previous output (if needed)</span>
<span class="o">!</span><span class="w"> </span>rm<span class="w"> </span>-r<span class="w"> </span>./afni_processing/sub_08.results

<span class="c1"># Rerun the processing script</span>
<span class="o">!</span><span class="w"> </span>tcsh<span class="w"> </span>-xef<span class="w"> </span>proc.sub_08<span class="w"> </span><span class="p">|&amp;</span><span class="w"> </span>tee<span class="w"> </span>output.proc.sub_08
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rm: cannot remove &#39;./afni_processing/sub_08.results&#39;: No such file or directory
/bin/bash: line 1: tcsh: command not found
</pre></div>
</div>
</div>
</div>
<p>While the preprocessing is running, here’s a brief overview of the key steps. For a more detailed explanation of each preprocessing stage, have another look at <a class="reference external" href="https://andysbrainbook.readthedocs.io/en/latest/AFNI/AFNI_Short_Course/AFNI_04_Preprocessing.html">Andy’s Brain Book’s excellent tutorial</a>.</p>
<section id="slice-time-correction">
<h4>Slice Time Correction<a class="headerlink" href="#slice-time-correction" title="Link to this heading">#</a></h4>
<p>Even though slice timing correction is often applied to functional data, in this dataset the slices were already aligned in time.<br />
When running <code class="docutils literal notranslate"><span class="pre">3dTshift</span></code>, AFNI detected this and simply created a copy of the input data without modification (as indicated by the warning message).</p>
<p>Normally, if slice timing correction were needed, it would use the first slice as the reference (specified by the <code class="docutils literal notranslate"><span class="pre">-tzero</span> <span class="pre">0</span></code> option in <code class="docutils literal notranslate"><span class="pre">3dTshift</span></code>).<br />
You can still see the slice timing correction step in the <code class="docutils literal notranslate"><span class="pre">proc.sub_08</span></code> script, but in this case, it had no effect on the data.</p>
<p><strong>Note:</strong> Although slice-timing correction is common, there are some general objections: it involves interpolating the data (which is best avoided when possible), it may not significantly improve results when the TR is short (e.g., around 1 second), and timing differences can sometimes be modeled later using a temporal derivative during model fitting.</p>
<div style="background-color: #fff9db; padding: 5px; border-radius: 5px; font-family: monospace; color: #333;">
<pre style="margin: 0; background-color: #fff9db;">
<span style="color: gray;"># =================== tshift ===================</span>  
foreach run ( $runs )
  3dTshift -tzero 0 -quintic -prefix pb01.$subj.r$run.tshift \
           pb00.$subj.r$run.tcat+orig
end
</pre>
</div></section>
<section id="registration-and-normalization">
<h4>Registration and Normalization<a class="headerlink" href="#registration-and-normalization" title="Link to this heading">#</a></h4>
<p>Registration aligns the functional and anatomical images. It usually begins by assuming the images are roughly in the same space; if not, their outlines are aligned.
To fine-tune the alignment, the algorithm uses differences in contrast (mutual information), matching dark areas on one image with bright areas on the other. AFNI’s preferred method is Local Pearson Correlation (LPC), which gives greater weight to brighter areas in the functional data.
Once a good alignment is found, the same transformations can later be applied to warp the functional images to a standard template.</p>
<p>In this example, AFNI’s <code class="docutils literal notranslate"><span class="pre">align_epi_anat.py</span></code> command is used to perform the registration. Although this tool can also handle slice-timing correction and functional volume alignment, it will be used here only for registration</p>
<p>The key options used are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-anat2epi</span></code>: Aligns the anatomical image to the functional image (not the other way around), minimizing changes to the functional data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-suffix</span></code> _al_junk: Adds a suffix to intermediate files, which will be useful for later steps.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-epi</span></code>, <code class="docutils literal notranslate"><span class="pre">-epi_base</span></code>, <code class="docutils literal notranslate"><span class="pre">-epi_strip</span></code>: Chooses the functional volume with least variability as the reference and strips non-brain tissue using 3dAutomask.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-giant_move</span></code>: Helps find an initial rough alignment if the images are very misaligned.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-volreg</span> <span class="pre">off</span></code>, <code class="docutils literal notranslate"><span class="pre">-tshift</span> <span class="pre">off</span></code>:  Indicates that alignment and slice-timing correction are not included in the current command.</p></li>
</ul>
</section>
<section id="registration-with-align-epi-anat-py">
<h4>Registration with <code class="docutils literal notranslate"><span class="pre">align_epi_anat.py</span></code><a class="headerlink" href="#registration-with-align-epi-anat-py" title="Link to this heading">#</a></h4>
<div style="background-color: #fff9db; padding: 5px; border-radius: 5px; font-family: monospace; color: #333;">
<pre style="margin: 0; background-color: #fff9db;">
<span style="color: gray;">=================== align ====================</span>
align_epi_anat.py -anat2epi -anat sub-08_T1w+orig \
     -save_skullstrip -suffix _al_junk          \
     -epi vr_base_min_outlier+orig -epi_base 0  \
     -epi_strip 3dAutomask                      \
     -giant_move                                \
     -volreg off -tshift off
</pre>
</div></section>
<section id="normalization-with-auto-tlrc">
<h4>Normalization with <code class="docutils literal notranslate"><span class="pre">&#64;auto_tlrc</span></code><a class="headerlink" href="#normalization-with-auto-tlrc" title="Link to this heading">#</a></h4>
<p>After registration, the anatomical image is normalized to a standard template (MNI_avg152T1) using AFNI’s <code class="docutils literal notranslate"><span class="pre">&#64;auto_tlrc</span></code> command. Since the anatomical image has already been skull-stripped, the <code class="docutils literal notranslate"><span class="pre">-no_ss</span></code> option is used. Because the centers of the anatomical and template images were far apart, the <code class="docutils literal notranslate"><span class="pre">-init_xform</span> <span class="pre">AUTO_CENTER</span></code> option was included.<br />
This helps by roughly aligning the centers of the two images before the fine registration step.
The transformation needed to align the anatomical image to the template is stored as an affine matrix in the header of the anatomical iamge.
This matrix is then extracted with the <code class="docutils literal notranslate"><span class="pre">cat_matvec</span></code> command and saved as <code class="docutils literal notranslate"><span class="pre">warp.anat.Xat.1D</span></code>, so it can later be applied to the functional images as well.</p>
<div style="background-color: #fff9db; padding: 5px; border-radius: 5px; font-family: monospace; color: #333;">
<pre style="margin: 0; background-color: #fff9db;">
<span style="color: gray;">#warp anatomy to standard space</span>
@auto_tlrc -base MNI_avg152T1+tlrc -input sub-08_T1w_ns+orig -no_ss -init_xform AUTO_CENTER
<p><span style="color: gray;">#store forward transformation matrix in a text file</span>
cat_matvec sub-08_T1w_ns+tlrc::WARP_DATA -I &gt; warp.anat.Xat.1D
</pre></p>
</div></section>
<section id="alignment-and-motion-correction">
<h4>Alignment and Motion Correction<a class="headerlink" href="#alignment-and-motion-correction" title="Link to this heading">#</a></h4>
<p>Motion correction is done with AFNI’s <code class="docutils literal notranslate"><span class="pre">3dvolreg</span></code> command.
The functional volumes are aligned to a reference image, which is selected as the volume with the fewest outliers (identified using <code class="docutils literal notranslate"><span class="pre">3dToutcount</span></code> earlier).
Motion parameters are saved into a text file (<code class="docutils literal notranslate"><span class="pre">-1Dfile</span></code>) and the corresponding affine transformation matrices into another file (<code class="docutils literal notranslate"><span class="pre">-1Dmatrix_save</span></code>).</p>
<div style="background-color: #fff9db; padding: 5px; border-radius: 5px; font-family: monospace; color: #333;">
<pre style="margin: 0; background-color: #fff9db;">
<span style="color: gray;"># =================== volreg ===================
#register and warp</span>
foreach run ( $runs )
    3dvolreg -verbose -zpad 1 -base vr_base_min_outlier+orig   \
           -1Dfile dfile.r$run.1D -prefix rm.epi.volreg.r$run  \
           -cubic                                              \
           -1Dmatrix_save mat.r$run.vr.aff12.1D                \
            pb01.$subj.r$run.tshift+orig
</pre>
</div><p>These motion correction matrices are then concatenated with the matrices from anatomical registration and normalization.</p>
<div style="background-color: #fff9db; padding: 5px; border-radius: 5px; font-family: monospace; color: #333;">
<pre style="margin: 0; background-color: #fff9db;">
<span style="color: gray;">#catenate volreg/epi2anat/tlrc xforms</span>
cat_matvec -ONELINE                                        \
         {$subj}_T1w_ns+tlrc::WARP_DATA -I                 \
         {$subj}_T1w_al_junk_mat.aff12.1D -I               \
         mat.r$run.vr.aff12.1D > mat.r$run.warp.aff12.1D
</pre>
</div><p>Using <code class="docutils literal notranslate"><span class="pre">3dAllineate</span></code> and the <code class="docutils literal notranslate"><span class="pre">-1Dmatrix_apply</span></code> option, both motion correction and normalization are applied to the functional images in one step.</p>
<div style="background-color: #fff9db; padding: 5px; border-radius: 5px; font-family: monospace; color: #333;">
<pre style="margin: 0; background-color: #fff9db;">
<span style="color: gray;">#warp the all-1 dataset for extents masking</span>
3dAllineate -base {$subj}_T1w_ns+tlrc                     \
          -input rm.epi.all1+orig                         \
          -1Dmatrix_apply mat.r$run.warp.aff12.1D         \
          -mast_dxyz 3 -final NN -quiet                   \
          -prefix rm.epi.1.r$run
</pre>
</div></section>
<section id="smoothing">
<h4>Smoothing<a class="headerlink" href="#smoothing" title="Link to this heading">#</a></h4>
<p>Smoothing is done with AFNI’s <code class="docutils literal notranslate"><span class="pre">3dmerge</span></code> command, which can be found under the “blur” header.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-1blur_fwhm</span></code> option applies spatial smoothing with a 4mm kernel, and <code class="docutils literal notranslate"><span class="pre">-doall</span></code> ensures smoothing is done across all volumes. After smoothing, the images are scaled to a mean intensity of 100, allowing changes to be interpreted as percent signal change. Finally, a brain mask is applied to remove non-brain voxels, preparing the data for statistical analysis.</p>
<div style="background-color: #fff9db; padding: 5px; border-radius: 5px; font-family: monospace; color: #333;">
<pre style="margin: 0; background-color: #fff9db;">
<span style="color: gray;"># ==================== blur ====================
#blur each volume of each run</span>   
foreach run ( $runs )
  3dmerge -1blur_fwhm 4.0 -doall -prefix pb03.$subj.r$run.blur \
          pb02.$subj.r$run.volreg+tlrc
end
</pre>
</div></section>
<section id="masking-and-scaling">
<h4>Masking and Scaling<a class="headerlink" href="#masking-and-scaling" title="Link to this heading">#</a></h4>
<section id="masking">
<h5>Masking<a class="headerlink" href="#masking" title="Link to this heading">#</a></h5>
<p>fMRI datasets include not only brain voxels but also irrelevant areas like the skull, neck, and air. To focus analysis and speed up processing, a mask is applied: voxels inside the mask are kept, and those outside are discarded. AFNI’s <code class="docutils literal notranslate"><span class="pre">3dAutomask</span></code> creates these masks by simply specifying the input and output datasets.</p>
<div style="background-color: #fff9db; padding: 5px; border-radius: 5px; font-family: monospace; color: #333;">
<pre style="margin: 0; background-color: #fff9db;">
<span style="color: gray;"># ==================== mask ====================
# create 'full_mask' dataset (union mask)</span>  
foreach run ( $runs )
    3dAutomask -prefix rm.mask_r$run pb03.$subj.r$run.blur+tlrc
end
</pre>
</div><p>The additional steps within the “mask” block combine individual fMRI masks into a union mask, compute a mask for the anatomical image, and take the intersection of both to define the final analysis region.</p>
</section>
<section id="scaling">
<h5>Scaling<a class="headerlink" href="#scaling" title="Link to this heading">#</a></h5>
<p>fMRI signal intensities are arbitrary and vary between subjects and runs. To make meaningful comparisons, AFNI scales each voxel’s time series to a mean of 100, allowing for consistent signal intensity contrasts between conditions and across subjects.</p>
<div style="background-color: #fff9db; padding: 5px; border-radius: 5px; font-family: monospace; color: #333;">
<pre style="margin: 0; background-color: #fff9db;">
<span style="color: gray;"># ==================== scale ====================
# scale each voxel time series to have a mean of 100
# (be sure no negatives creep in)
# (subject to a range of [0,200])</span>  
foreach run ( $runs )
    3dTstat -prefix rm.mean_r$run pb03.$subj.r$run.blur+tlrc
    3dcalc -a pb03.$subj.r$run.blur+tlrc -b rm.mean_r$run+tlrc \
           -c mask_epi_extents+tlrc                            \
           -expr 'c * min(200, a/b*100)*step(a)*step(b)'       \
           -prefix pb04.$subj.r$run.scale
end 
</pre>
</div><p><strong>Effect of Scaling:</strong> Before scaling, time-series values are arbitrary and vary between subjects. After scaling, each subject’s data is normalized to the same mean, enabling consistent comparisons across runs and subjects. To visualize both the original and scaled data with Matplotlib, the AFNI format needs to be converted to NIfTI format using the <code class="docutils literal notranslate"><span class="pre">3dAFNItonNIFI</span></code> command.
The following plot compares the signal intensity time series from a voxel at the center of the brain, before and after scaling. The red dashed line indicates the mean signal intensity for each time series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>3dAFNItoNIFTI<span class="w"> </span>-prefix<span class="w"> </span>./afni_processing/sub_08.results/pb03.sub_08.r01.blur.nii.gz<span class="w"> </span>./afni_processing/sub_08.results/pb03.sub_08.r01.blur+tlrc
<span class="o">!</span>3dAFNItoNIFTI<span class="w"> </span>-prefix<span class="w"> </span>./afni_processing/sub_08.results/pb04.sub_08.r01.scale.nii.gz<span class="w"> </span>./afni_processing/sub_08.results/pb04.sub_08.r01.scale+tlrc
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>++ 3dAFNItoNIFTI: AFNI version=AFNI_21.2.00 (Jul  8 2021) [64-bit]
** FATAL ERROR: Can&#39;t open dataset &#39;./afni_processing/sub_08.results/pb03.sub_08.r01.blur+tlrc&#39;
** Program compile date = Jul  8 2021
++ 3dAFNItoNIFTI: AFNI version=AFNI_21.2.00 (Jul  8 2021) [64-bit]
** FATAL ERROR: Can&#39;t open dataset &#39;./afni_processing/sub_08.results/pb04.sub_08.r01.scale+tlrc&#39;
** Program compile date = Jul  8 2021
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">blur_nii</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;./afni_processing/sub_08.results/pb03.sub_08.r01.blur.nii.gz&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
<span class="n">scale_nii</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;./afni_processing/sub_08.results/pb04.sub_08.r01.scale.nii.gz&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>

<span class="c1"># Choose a voxel (e.g., center)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">blur_nii</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">blur_nii</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">blur_nii</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span>
<span class="n">time_series1</span> <span class="o">=</span> <span class="n">blur_nii</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">time_series2</span> <span class="o">=</span> <span class="n">scale_nii</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">n_timepoints</span> <span class="o">=</span> <span class="n">time_series1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Calculate the means of the time series</span>
<span class="n">mean_time_series1</span> <span class="o">=</span> <span class="n">time_series1</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">mean_time_series2</span> <span class="o">=</span> <span class="n">time_series2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Create subplots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_series1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Signal intensity before scaling&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Signal Intensity&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">mean_time_series1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mean: </span><span class="si">{</span><span class="n">mean_time_series1</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_timepoints</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_series2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Signal intensity after scaling&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Timepoint&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Signal Intensity&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">mean_time_series2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mean: </span><span class="si">{</span><span class="n">mean_time_series2</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_timepoints</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">File ~/.local/lib/python3.10/site-packages/nibabel/loadsave.py:101,</span> in <span class="ni">load</span><span class="nt">(filename, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">100</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">101</span>     <span class="n">stat_result</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">102</span> <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;afni_processing/sub_08.results/pb03.sub_08.r01.blur.nii.gz&#39;

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">blur_nii</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;./afni_processing/sub_08.results/pb03.sub_08.r01.blur.nii.gz&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">scale_nii</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;./afni_processing/sub_08.results/pb04.sub_08.r01.scale.nii.gz&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># Choose a voxel (e.g., center)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nibabel/loadsave.py:103,</span> in <span class="ni">load</span><span class="nt">(filename, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">101</span>     <span class="n">stat_result</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">102</span> <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">103</span>     <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No such file or no access: &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">104</span> <span class="k">if</span> <span class="n">stat_result</span><span class="o">.</span><span class="n">st_size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">105</span>     <span class="k">raise</span> <span class="n">ImageFileError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Empty file: &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: No such file or no access: &#39;afni_processing/sub_08.results/pb03.sub_08.r01.blur.nii.gz&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="results-checking-preprocessing">
<h2>Results: Checking Preprocessing<a class="headerlink" href="#results-checking-preprocessing" title="Link to this heading">#</a></h2>
<p>Let’s have a look at the results directory. The files containing the <strong>pb</strong> string are the preprocessed functional images at each preprocessing step, and the files with the <strong>T1w</strong> string are the preprocessed anatomical images. Auxiliary functional images are created to assist with specific preprocessing steps, and auxiliary text files contain information about transformation matrices and movement parameter:</p>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>ls<span class="w"> </span>./afni_processing/sub_08.results
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@epi_review.sub_08			 pb01.sub_08.r01.tshift+orig.HEAD
anat_final.sub_08+tlrc.BRIK		 pb01.sub_08.r02.tshift+orig.BRIK
anat_final.sub_08+tlrc.HEAD		 pb01.sub_08.r02.tshift+orig.HEAD
anat_w_skull_warped+tlrc.BRIK		 pb02.sub_08.r01.volreg+tlrc.BRIK
anat_w_skull_warped+tlrc.HEAD		 pb02.sub_08.r01.volreg+tlrc.HEAD
dfile.r01.1D				 pb02.sub_08.r02.volreg+tlrc.BRIK
dfile.r02.1D				 pb02.sub_08.r02.volreg+tlrc.HEAD
dfile_rall.1D				 pb03.sub_08.r01.blur+tlrc.BRIK
final_epi_vr_base_min_outlier+tlrc.BRIK  pb03.sub_08.r01.blur+tlrc.HEAD
final_epi_vr_base_min_outlier+tlrc.HEAD  pb03.sub_08.r01.blur.nii.gz
full_mask.sub_08+tlrc.BRIK		 pb03.sub_08.r02.blur+tlrc.BRIK
full_mask.sub_08+tlrc.HEAD		 pb03.sub_08.r02.blur+tlrc.HEAD
mask_anat.sub_08+tlrc.BRIK		 pb04.sub_08.r01.scale+tlrc.BRIK
mask_anat.sub_08+tlrc.HEAD		 pb04.sub_08.r01.scale+tlrc.HEAD
mask_epi_anat.sub_08+tlrc.BRIK		 pb04.sub_08.r01.scale.nii.gz
mask_epi_anat.sub_08+tlrc.HEAD		 pb04.sub_08.r02.scale+tlrc.BRIK
mask_epi_extents+tlrc.BRIK		 pb04.sub_08.r02.scale+tlrc.HEAD
mask_epi_extents+tlrc.HEAD		 pre.sub-08_T1w_ns+orig.BRIK
mask_group+tlrc.BRIK			 pre.sub-08_T1w_ns+orig.HEAD
mask_group+tlrc.HEAD			 pre.sub-08_T1w_ns_WarpDrive.log
mat.basewarp.aff12.1D			 stimuli
mat.r01.vr.aff12.1D			 sub-08_T1w+orig.BRIK
mat.r01.warp.aff12.1D			 sub-08_T1w+orig.HEAD
mat.r02.vr.aff12.1D			 sub-08_T1w_al_junk+orig.BRIK
mat.r02.warp.aff12.1D			 sub-08_T1w_al_junk+orig.HEAD
motion_sub_08_enorm.1D			 sub-08_T1w_al_junk_mat.aff12.1D
out.allcostX.txt			 sub-08_T1w_ns+orig.BRIK
out.mask_ae_dice.txt			 sub-08_T1w_ns+orig.HEAD
out.mask_ae_overlap.txt			 sub-08_T1w_ns+tlrc.BRIK
out.mask_at_dice.txt			 sub-08_T1w_ns+tlrc.HEAD
out.min_outlier.txt			 sub-08_T1w_ns.Xaff12.1D
out.pre_ss_warn.txt			 sub-08_T1w_ns.Xat.1D
outcount.r01.1D				 sub-08_T1w_ns.maskwarp.Xat.1D
outcount.r02.1D				 sub-08_T1w_ns_shft.1D
outcount_rall.1D			 volumized+tlrc.BRIK
pb00.sub_08.r01.tcat+orig.BRIK		 volumized+tlrc.HEAD
pb00.sub_08.r01.tcat+orig.HEAD		 vr_base_min_outlier+orig.BRIK
pb00.sub_08.r02.tcat+orig.BRIK		 vr_base_min_outlier+orig.HEAD
pb00.sub_08.r02.tcat+orig.HEAD		 warp.anat.Xat.1D
pb01.sub_08.r01.tshift+orig.BRIK
</pre></div>
</div>
</div>
</div>
<div style="background-color: #ffe5cc; padding: 10px; border-radius: 5px;">
    <div style="background-color: #ff9900; padding: 5px; border-radius: 5px; font-weight: bold;">
        <span style="font-size: 15px; color: #ff9900; background-color: white; border-radius: 50%; width: 20px; height: 20px; display: inline-block; text-align: center; line-height: 20px;">
            !
        </span> <span style="color: white;">Warning:</span>
    </div>
    <p style="margin: 10px 0;">
        In AFNI, a +tlrc extension (and the “Talairach View”) indicates that the image has been normalized. However, this does not necessarily mean the image is in Talairach space. The Talairach label is retained for legacy reasons, ensuring compatibility with older versions of the software. To verify which space the image has been warped to, you can use the <code>3dinfo</code> command and check the “Template Space” field. The three possibilities are: “ORIG” (the image has not been warped), “TLRC” (normalized to Talairach space), and “MNI” (normalized to MNI space).
    </p>
</div><section id="visualizations">
<h3>Visualizations<a class="headerlink" href="#visualizations" title="Link to this heading">#</a></h3>
<p>To visualize the preprocessing outputs with <strong>ipyniivue</strong>, the files are first converted to NIfTI format. Once loaded, check whether the functional and anatomical images are properly aligned to MNI space. Misalignments could indicate issues with the preprocessing steps. Smoothed images will generally appear less detailed than the original images due to the blurring effect; this is expected, but they should not be excessively blurry or too sharp. The scaled functional image will have less anatomical definition, as the signal intensity has been normalized across time, making it more uniform across brain voxels. When reviewing the masks, ensure they appropriately cover the brain regions of interest and match the underlying anatomy. For example, the “mask_group” is typically a more liberal mask compared to the “full_mask”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>3dAFNItoNIFTI<span class="w"> </span>-prefix<span class="w"> </span>./afni_processing/mni152.nii.gz<span class="w"> </span>/cvmfs/neurodesk.ardc.edu.au/containers/afni_21.2.00_20210714/afni_21.2.00_20210714.simg/opt/afni-latest/MNI_avg152T1+tlrc
<span class="o">!</span>3dAFNItoNIFTI<span class="w"> </span>-prefix<span class="w"> </span>./afni_processing/sub_08.results/anat_w_skull_warped.nii.gz<span class="w"> </span>./afni_processing/sub_08.results/anat_w_skull_warped+tlrc
<span class="o">!</span>3dAFNItoNIFTI<span class="w"> </span>-prefix<span class="w"> </span>./afni_processing/sub_08.results/anat_final.nii.gz<span class="w"> </span>./afni_processing/sub_08.results/anat_final.sub_08+tlrc
<span class="o">!</span>3dAFNItoNIFTI<span class="w"> </span>-prefix<span class="w"> </span>./afni_processing/sub_08.results/pb02.sub_08.r01.volreg+tlrc.nii.gz<span class="w"> </span>./afni_processing/sub_08.results/pb02.sub_08.r01.volreg+tlrc
<span class="o">!</span>3dAFNItoNIFTI<span class="w"> </span>-prefix<span class="w"> </span>./afni_processing/sub_08.results/full_mask.sub_08+tlrc.nii.gz<span class="w"> </span>./afni_processing/sub_08.results/full_mask.sub_08+tlrc
<span class="o">!</span>3dAFNItoNIFTI<span class="w"> </span>-prefix<span class="w"> </span>./afni_processing/sub_08.results/mask_group.nii.gz<span class="w"> </span>./afni_processing/sub_08.results/mask_group+tlrc
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>++ 3dAFNItoNIFTI: AFNI version=AFNI_21.2.00 (Jul  8 2021) [64-bit]
++ 3dAFNItoNIFTI: AFNI version=AFNI_21.2.00 (Jul  8 2021) [64-bit]
++ 3dAFNItoNIFTI: AFNI version=AFNI_21.2.00 (Jul  8 2021) [64-bit]
++ 3dAFNItoNIFTI: AFNI version=AFNI_21.2.00 (Jul  8 2021) [64-bit]
*+ WARNING: varying brick factors, writing NIfTI as float
++ 3dAFNItoNIFTI: AFNI version=AFNI_21.2.00 (Jul  8 2021) [64-bit]
++ 3dAFNItoNIFTI: AFNI version=AFNI_21.2.00 (Jul  8 2021) [64-bit]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Paths to files</span>
<span class="n">anat_skull</span> <span class="o">=</span> <span class="s1">&#39;./afni_processing/sub_08.results/anat_w_skull_warped.nii.gz&#39;</span>
<span class="n">anat_final</span> <span class="o">=</span> <span class="s1">&#39;./afni_processing/sub_08.results/anat_final.nii.gz&#39;</span>
<span class="n">volreg_func</span> <span class="o">=</span> <span class="s1">&#39;./afni_processing/sub_08.results/pb02.sub_08.r01.volreg+tlrc.nii.gz&#39;</span>
<span class="n">mni_nifti</span> <span class="o">=</span> <span class="s1">&#39;./afni_processing/mni152.nii.gz&#39;</span>
<span class="n">full_mask</span> <span class="o">=</span> <span class="s1">&#39;./afni_processing/sub_08.results/full_mask.sub_08+tlrc.nii.gz&#39;</span>
<span class="n">group_mask</span> <span class="o">=</span> <span class="s1">&#39;./afni_processing/sub_08.results/mask_group.nii.gz&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nv</span> <span class="o">=</span> <span class="n">NiiVue</span><span class="p">()</span>

<span class="c1"># Paths to all volumes</span>
<span class="n">volumes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">mni_nifti</span><span class="p">,</span> <span class="s2">&quot;colormap&quot;</span><span class="p">:</span> <span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>  <span class="c1"># MNI background</span>
    <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">anat_final</span><span class="p">,</span> <span class="s2">&quot;colormap&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">},</span>  <span class="c1"># default overlay</span>
    <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">volreg_func</span><span class="p">,</span> <span class="s2">&quot;colormap&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">full_mask</span><span class="p">,</span>  <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">group_mask</span><span class="p">,</span>  <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span>
<span class="p">]</span>

<span class="c1"># Load all volumes into viewer</span>
<span class="n">nv</span><span class="o">.</span><span class="n">load_volumes</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span>

<span class="c1"># Dropdown options</span>
<span class="n">overlay_dropdown</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
    <span class="n">options</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;Anatomical aligned to MNI&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Motion-corrected functional to MNI&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Union of functional masks (full_mask)&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Dilated group mask (group_mask)&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Overlay:&#39;</span><span class="p">,</span>
    <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">},</span>
    <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;350px&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Update function</span>
<span class="k">def</span><span class="w"> </span><span class="nf">update_overlay</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
    <span class="n">selected_idx</span> <span class="o">=</span> <span class="n">change</span><span class="o">.</span><span class="n">new</span>

    <span class="c1"># Set all overlays to 0 opacity</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">volumes</span><span class="p">)):</span>
        <span class="n">nv</span><span class="o">.</span><span class="n">volumes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1"># Activate the selected one</span>
    <span class="n">nv</span><span class="o">.</span><span class="n">volumes</span><span class="p">[</span><span class="n">selected_idx</span><span class="p">]</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.7</span>

<span class="c1"># Attach the observer</span>
<span class="n">overlay_dropdown</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">update_overlay</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>

<span class="c1"># Show viewer and dropdown</span>
<span class="n">display</span><span class="p">(</span><span class="n">VBox</span><span class="p">([</span><span class="n">overlay_dropdown</span><span class="p">,</span> <span class="n">nv</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "e40df09fb60d46b8b2e725c85cf13c0e", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://raw.githubusercontent.com/NeuroDesk/example-notebooks/refs/heads/main/books/images/afni_preproc_alignment.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><img src="https://raw.githubusercontent.com/NeuroDesk/example-notebooks/refs/heads/main/books/images/afni_preproc_alignment.png"/></div></div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#output-cpu-information">Output CPU information</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-afni">Load AFNI</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-python-modules">Import Python Modules</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inspecting-the-anatomical-and-functional-images">Inspecting the anatomical and functional images</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#afni-commands-and-preprocessing">AFNI Commands and Preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#afni-commands">1. AFNI commands</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">2. Preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#slice-time-correction">Slice Time Correction</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#registration-and-normalization">Registration and Normalization</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#registration-with-align-epi-anat-py">Registration with <code class="docutils literal notranslate"><span class="pre">align_epi_anat.py</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#normalization-with-auto-tlrc">Normalization with <code class="docutils literal notranslate"><span class="pre">@auto_tlrc</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#alignment-and-motion-correction">Alignment and Motion Correction</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#smoothing">Smoothing</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#masking-and-scaling">Masking and Scaling</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#masking">Masking</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#scaling">Scaling</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results-checking-preprocessing">Results: Checking Preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizations">Visualizations</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Neurodesk Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>